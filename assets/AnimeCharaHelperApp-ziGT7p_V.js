import{j as a,a as e,F as la}from"./index-WcmAaxBA.js";import{b as n,A as Oe,T as ae,x as Da,y as Fe,z as oa,D as ca,G as he,F as J,H as ie,J as da,C as ha,S as aa,u as ua,K as ta,M as ia,I as Ta}from"./vendor-B9lPEkq4.js";import{u as Ba,A as Ea}from"./AIAssistant-fp7EeI3B.js";import{u as ma}from"./useAuth-CLSV77f7.js";import{c as ke,g as Fa}from"./api-DX6zK3xw.js";import{G as Z,m as pa,n as ga,b as Ha,o as $a,p as be,q as ze,r as Ge,t as Ie,v as va,w as fa,h as Pe,c as ya,x as Ua,f as Ye,y as je,z as ba,k as ue,A as Va,B as Me,D as qe,E as Ae,F as Oa,H as Ga,J as _a,K as Ya,L as ja,M as qa,N as Wa,d as xe,O as Ja,P as Na,Q as Za,R as na,S as Xa,e as Qa,g as Ka,C as et,l as at,u as tt,s as it}from"./smartPromptEngine-Dc2xad7S.js";import{A as nt}from"./ArrowBack-D_LrkQ9Z.js";function st(i){return Z({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8.58564 8.85449L3.63589 13.8042L8.83021 18.9985L9.99985 18.9978V18.9966H11.1714L14.9496 15.2184L8.58564 8.85449ZM9.99985 7.44027L16.3638 13.8042L19.1922 10.9758L12.8283 4.61185L9.99985 7.44027ZM13.9999 18.9966H20.9999V20.9966H11.9999L8.00229 20.9991L1.51457 14.5113C1.12405 14.1208 1.12405 13.4877 1.51457 13.0971L12.1212 2.49053C12.5117 2.1 13.1449 2.1 13.5354 2.49053L21.3136 10.2687C21.7041 10.6592 21.7041 11.2924 21.3136 11.6829L13.9999 18.9966Z"},child:[]}]})(i)}function rt(i){return Z({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M13.5 2C13.5 2.44425 13.3069 2.84339 13 3.11805V5H18C19.6569 5 21 6.34315 21 8V18C21 19.6569 19.6569 21 18 21H6C4.34315 21 3 19.6569 3 18V8C3 6.34315 4.34315 5 6 5H11V3.11805C10.6931 2.84339 10.5 2.44425 10.5 2C10.5 1.17157 11.1716 0.5 12 0.5C12.8284 0.5 13.5 1.17157 13.5 2ZM6 7C5.44772 7 5 7.44772 5 8V18C5 18.5523 5.44772 19 6 19H18C18.5523 19 19 18.5523 19 18V8C19 7.44772 18.5523 7 18 7H13H11H6ZM2 10H0V16H2V10ZM22 10H24V16H22V10ZM9 14.5C9.82843 14.5 10.5 13.8284 10.5 13C10.5 12.1716 9.82843 11.5 9 11.5C8.17157 11.5 7.5 12.1716 7.5 13C7.5 13.8284 8.17157 14.5 9 14.5ZM15 14.5C15.8284 14.5 16.5 13.8284 16.5 13C16.5 12.1716 15.8284 11.5 15 11.5C14.1716 11.5 13.5 12.1716 13.5 13C13.5 13.8284 14.1716 14.5 15 14.5Z"},child:[]}]})(i)}function lt(i){return Z({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M15.825.12a.5.5 0 0 1 .132.584c-1.53 3.43-4.743 8.17-7.095 10.64a6.1 6.1 0 0 1-2.373 1.534c-.018.227-.06.538-.16.868-.201.659-.667 1.479-1.708 1.74a8.1 8.1 0 0 1-3.078.132 4 4 0 0 1-.562-.135 1.4 1.4 0 0 1-.466-.247.7.7 0 0 1-.204-.288.62.62 0 0 1 .004-.443c.095-.245.316-.38.461-.452.394-.197.625-.453.867-.826.095-.144.184-.297.287-.472l.117-.198c.151-.255.326-.54.546-.848.528-.739 1.201-.925 1.746-.896q.19.012.348.048c.062-.172.142-.38.238-.608.261-.619.658-1.419 1.187-2.069 2.176-2.67 6.18-6.206 9.117-8.104a.5.5 0 0 1 .596.04M4.705 11.912a1.2 1.2 0 0 0-.419-.1c-.246-.013-.573.05-.879.479-.197.275-.355.532-.5.777l-.105.177c-.106.181-.213.362-.32.528a3.4 3.4 0 0 1-.76.861c.69.112 1.736.111 2.657-.12.559-.139.843-.569.993-1.06a3 3 0 0 0 .126-.75zm1.44.026c.12-.04.277-.1.458-.183a5.1 5.1 0 0 0 1.535-1.1c1.9-1.996 4.412-5.57 6.052-8.631-2.59 1.927-5.566 4.66-7.302 6.792-.442.543-.795 1.243-1.042 1.826-.121.288-.214.54-.275.72v.001l.575.575zm-4.973 3.04.007-.005zm3.582-3.043.002.001h-.002z"},child:[]}]})(i)}function ot(i){return Z({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828zm2.121.707a1 1 0 0 0-1.414 0L4.16 7.547l5.293 5.293 4.633-4.633a1 1 0 0 0 0-1.414zM8.746 13.547 3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293z"},child:[]}]})(i)}function ct(i){return Z({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M9.5 2.672a.5.5 0 1 0 1 0V.843a.5.5 0 0 0-1 0zm4.5.035A.5.5 0 0 0 13.293 2L12 3.293a.5.5 0 1 0 .707.707zM7.293 4A.5.5 0 1 0 8 3.293L6.707 2A.5.5 0 0 0 6 2.707zm-.621 2.5a.5.5 0 1 0 0-1H4.843a.5.5 0 1 0 0 1zm8.485 0a.5.5 0 1 0 0-1h-1.829a.5.5 0 0 0 0 1zM13.293 10A.5.5 0 1 0 14 9.293L12.707 8a.5.5 0 1 0-.707.707zM9.5 11.157a.5.5 0 0 0 1 0V9.328a.5.5 0 0 0-1 0zm1.854-5.097a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L8.646 5.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0l1.293-1.293Zm-3 3a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L.646 13.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0z"},child:[]}]})(i)}function dt(i){return Z({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M0 .5A.5.5 0 0 1 .5 0h5a.5.5 0 0 1 .5.5v5.277l4.147-4.131a.5.5 0 0 1 .707 0l3.535 3.536a.5.5 0 0 1 0 .708L10.261 10H15.5a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5H3a3 3 0 0 1-2.121-.879A3 3 0 0 1 0 13.044m6-.21 7.328-7.3-2.829-2.828L6 7.188zM4.5 13a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0M15 15v-4H9.258l-4.015 4zM0 .5v12.495zm0 12.495V13z"},child:[]}]})(i)}function ht(i){return Z({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M10.646.646a.5.5 0 0 1 .708 0l4 4a.5.5 0 0 1 0 .708l-1.902 1.902-.829 3.313a1.5 1.5 0 0 1-1.024 1.073L1.254 14.746 4.358 4.4A1.5 1.5 0 0 1 5.43 3.377l3.313-.828zm-1.8 2.908-3.173.793a.5.5 0 0 0-.358.342l-2.57 8.565 8.567-2.57a.5.5 0 0 0 .34-.357l.794-3.174-3.6-3.6z"},child:[]},{tag:"path",attr:{fillRule:"evenodd",d:"M2.832 13.228 8 9a1 1 0 1 0-1-1l-4.228 5.168-.026.086z"},child:[]}]})(i)}function ut(i){return Z({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(i)}function Sa(i){return Z({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M512 0C460.22 3.56 96.44 38.2 71.01 287.61c-3.09 26.66-4.84 53.44-5.99 80.24l178.87-178.69c6.25-6.25 16.4-6.25 22.65 0s6.25 16.38 0 22.63L7.04 471.03c-9.38 9.37-9.38 24.57 0 33.94 9.38 9.37 24.59 9.37 33.98 0l57.13-57.07c42.09-.14 84.15-2.53 125.96-7.36 53.48-5.44 97.02-26.47 132.58-56.54H255.74l146.79-48.88c11.25-14.89 21.37-30.71 30.45-47.12h-81.14l106.54-53.21C500.29 132.86 510.19 26.26 512 0z"},child:[]}]})(i)}function mt(i){return Z({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M204.3 5C104.9 24.4 24.8 104.3 5.2 203.4c-37 187 131.7 326.4 258.8 306.7 41.2-6.4 61.4-54.6 42.5-91.7-23.1-45.4 9.9-98.4 60.9-98.4h79.7c35.8 0 64.8-29.6 64.9-65.3C511.5 97.1 368.1-26.9 204.3 5zM96 320c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm32-128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128-64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"},child:[]}]})(i)}function pt(i){return Z({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z"},child:[]}]})(i)}function gt(i){return Z({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"m20.707 5.826-3.535-3.533a.999.999 0 0 0-1.408-.006L7.096 10.82a1.01 1.01 0 0 0-.273.488l-1.024 4.437L4 18h2.828l1.142-1.129 3.588-.828c.18-.042.345-.133.477-.262l8.667-8.535a1 1 0 0 0 .005-1.42zm-9.369 7.833-2.121-2.12 7.243-7.131 2.12 2.12-7.242 7.131zM4 20h16v2H4z"},child:[]}]})(i)}function vt(i){return Z({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M4 21a1 1 0 0 0 .24 0l4-1a1 1 0 0 0 .47-.26L21 7.41a2 2 0 0 0 0-2.82L19.42 3a2 2 0 0 0-2.83 0L4.3 15.29a1.06 1.06 0 0 0-.27.47l-1 4A1 1 0 0 0 3.76 21 1 1 0 0 0 4 21zM18 4.41 19.59 6 18 7.59 16.42 6zM5.91 16.51 15 7.41 16.59 9l-9.1 9.1-2.11.52z"},child:[]}]})(i)}function ft(i){return Z({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M19 20h-10.5l-4.21 -4.3a1 1 0 0 1 0 -1.41l10 -10a1 1 0 0 1 1.41 0l5 5a1 1 0 0 1 0 1.41l-9.2 9.3"},child:[]},{tag:"path",attr:{d:"M18 13.3l-6.3 -6.3"},child:[]}]})(i)}const sa=[{key:"back",icon:Ha,label:"Back",action:"mode",value:"back",category:"navigation"},{key:"creative",icon:$a,label:"Draw",action:"mode",value:"creative",category:"drawing"},{key:"brush",icon:be,label:"Brush",action:"tool",value:"brush",category:"drawing"},{key:"pencil",icon:vt,label:"Pencil",action:"tool",value:"pencil",category:"drawing"},{key:"marker",icon:ut,label:"Marker",action:"tool",value:"marker",category:"drawing"},{key:"airbrush",icon:ze,label:"Airbrush",action:"tool",value:"airbrush",category:"drawing"},{key:"fine-liner",icon:Sa,label:"Fine Liner (Eyelashes)",action:"tool",value:"fine-liner",category:"drawing"},{key:"detail-brush",icon:gt,label:"Detail Brush",action:"tool",value:"detail-brush",category:"drawing"},{key:"texture-brush",icon:be,label:"Texture Brush",action:"tool",value:"texture-brush",category:"drawing"},{key:"eraser",icon:st,label:"Eraser",action:"tool",value:"eraser",category:"drawing"},{key:"precision-eraser",icon:ft,label:"Precision Eraser",action:"tool",value:"precision-eraser",category:"drawing"},{key:"character-library",icon:Ge,label:"Character Library",action:"function",value:"character-library",category:"v12"},{key:"ai-color-assistant",icon:dt,label:"AI Color Assistant",action:"function",value:"ai-color-assistant",category:"v12"},{key:"smart-brush",icon:Ie,label:"Smart Brush",action:"function",value:"smart-brush",category:"v12"},{key:"version-history",icon:va,label:"Version History",action:"function",value:"version-history",category:"v12"},{key:"templates",icon:mt,label:"Templates",action:"context",value:"templates",category:"creation"},{key:"poses",icon:pt,label:"Poses",action:"context",value:"poses",category:"creation"},{key:"yumi-refs",icon:Ge,label:"Yumi References",action:"function",value:"yumi-refs",category:"creation"},{key:"ai",icon:rt,label:"AI Generate",action:"mode",value:"ai-generate",category:"ai"},{key:"ai-outline",icon:ht,label:"AI Outline",action:"tool",value:"ai-outline",category:"ai"},{key:"ai-brush",icon:ze,label:"AI Brush",action:"tool",value:"ai-brush",category:"ai"},{key:"ai-eraser",icon:ct,label:"AI Eraser",action:"tool",value:"ai-eraser",category:"ai"},{key:"search",icon:fa,label:"Search Photos",action:"context",value:"search",category:"panels"},{key:"upload",icon:Pe,label:"Upload Files",action:"function",value:"upload",category:"utility"},{key:"customize",icon:ya,label:"Customize",action:"function",value:"customize",category:"utility"},{key:"layers",icon:Ua,label:"Layers",action:"context",value:"layers",category:"panels"},{key:"palette",icon:Ye,label:"Colors",action:"context",value:"palette",category:"panels"},{key:"history",icon:je,label:"History",action:"context",value:"history",category:"panels"},{key:"export",icon:ba,label:"Export",action:"context",value:"export",category:"panels"}],Ca=({mode:i,context:f,setMode:w,setContext:z,onBack:v,onToolChange:b,selectedTool:p,onCustomizeToggle:m,onFileUpload:h,onYumiRefsToggle:L,onCharacterLibraryToggle:I,onAIColorAssistantToggle:T,onSmartBrushToggle:g,onVersionHistoryToggle:R})=>{const[k,P]=n.useState(!1),[c,D]=n.useState(!1),[u,C]=n.useState({x:0,y:0}),[E,o]=n.useState({x:0,y:0}),r=n.useRef(null),N=n.useRef(null),t=y=>{var _;if(y.target===r.current||y.target.closest(".drag-handle")){D(!0);const H=(_=r.current)==null?void 0:_.getBoundingClientRect();H&&o({x:y.clientX-H.left,y:y.clientY-H.top})}},d=y=>{c&&C({x:y.clientX-E.x,y:y.clientY-E.y})},M=()=>{D(!1)};n.useEffect(()=>{if(c)return document.addEventListener("mousemove",d),document.addEventListener("mouseup",M),()=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",M)}},[c,E]);const F=y=>{const _=Array.from(y.target.files||[]);_.length>0&&h&&h(_)},G=y=>{var _;if(y.key==="back"){v();return}y.action==="mode"?w(y.value):y.action==="context"?z(f===y.value?null:y.value):y.action==="tool"?b==null||b(y.value):y.action==="function"&&(y.key==="upload"?(_=N.current)==null||_.click():y.key==="customize"?m==null||m():y.key==="yumi-refs"?L==null||L():y.key==="character-library"?I==null||I():y.key==="ai-color-assistant"?T==null||T():y.key==="smart-brush"?g==null||g():y.key==="version-history"&&(R==null||R()))},O=()=>{P(!k)},Q=()=>i==="ai-generate"?sa.filter(y=>y.category==="navigation"||y.category==="ai"||y.category==="creation"||y.category==="utility"||y.category==="v12"||y.key==="export"||y.key==="search"):sa;return a("nav",{ref:r,className:`icon-bar ${k?"collapsed":""} ${c?"dragging":""}`,style:{transform:`translate(${u.x}px, ${u.y}px)`,cursor:c?"grabbing":"default"},onMouseDown:t,children:[e("input",{type:"file",ref:N,multiple:!0,accept:"image/*",onChange:F,style:{display:"none"}}),e("div",{className:"drag-handle",children:a("div",{className:"drag-dots",children:[e("span",{}),e("span",{}),e("span",{})]})}),e("button",{className:"collapse-toggle",onClick:O,title:k?"Expand Sidebar":"Collapse Sidebar",children:k?e(pa,{size:16}):e(ga,{size:16})}),e("div",{className:"icons-container",children:Q().map(y=>{const _=y.icon,H=y.action==="mode"&&i===y.value||y.action==="context"&&f===y.value||y.action==="tool"&&p===y.value;return a("button",{className:`icon-button ${H?"active":""} ${y.category||""}`,onClick:()=>G(y),title:y.label,children:[e(_,{size:k?18:24}),!k&&e("span",{className:"icon-label",children:y.label}),y.category==="v12"&&!k&&e("span",{className:"version-badge",children:"v1.2"})]},y.key)})}),!k&&a("div",{className:"category-info",children:[e("div",{className:"category-separator"}),e("span",{className:"category-label",children:i==="ai-generate"?"AI Mode":"Creative Mode v1.2"})]})]})},We=({onSelect:i,onClose:f})=>{const[w,z]=n.useState(""),[v,b]=n.useState([]),[p,m]=n.useState(!1),h=async()=>{if(w.trim()){m(!0);try{const L=await fetch(`/api/anime-chara/reference-search?q=${encodeURIComponent(w)}`);if(!L.ok)throw new Error("Search failed");const I=await L.json();b(I.results)}catch(L){console.error("Reference search failed:",L)}finally{m(!1)}}};return a("div",{className:"reference-search",children:[a("div",{className:"search-header",children:[a("div",{className:"search-input",children:[e("input",{type:"text",value:w,onChange:L=>z(L.target.value),placeholder:"Search for reference images...",onKeyPress:L=>L.key==="Enter"&&h()}),e("button",{onClick:h,disabled:p,children:e(fa,{size:20})})]}),e("button",{className:"close-button",onClick:f,children:e(ue,{size:20})})]}),e("div",{className:"search-results",children:p?e("div",{className:"loading",children:"Loading..."}):v.length>0?e("div",{className:"results-grid",children:v.map((L,I)=>e("div",{className:"result-item",onClick:()=>i(L),children:e("img",{src:L,alt:`Reference ${I+1}`})},I))}):e("div",{className:"no-results",children:w?"No results found":"Start searching for reference images"})})]})},wa=n.forwardRef((i,f)=>{const{mode:w,tool:z,color:v,size:b,opacity:p,blendMode:m,zoom:h,position:L,activeLayer:I,onStateChange:T,layers:g,activeLayerId:R,onLayerChange:k,width:P=800,height:c=600}=i,D=n.useRef(null);n.useRef(null);const u=n.useRef(null),[C,E]=n.useState(!1),[o,r]=n.useState(!1),[N,t]=n.useState(!1),[d,M]=n.useState(!1),[F,G]=n.useState(null),[O,Q]=n.useState(z),[y,_]=n.useState(v),[H,$]=n.useState(b),[me,Je]=n.useState(p),[Ne,Ze]=n.useState(m),[Re,re]=n.useState(!1),[le,Y]=n.useState(null),[K,X]=n.useState(!1),[pe,oe]=n.useState(.5);n.useEffect(()=>{g.length===0&&ge("Background")},[]);const ge=(S=`Layer ${g.length+1}`)=>{const A=D.current;if(!A)return;const B=document.createElement("canvas");B.width=A.width,B.height=A.height;const q={id:`layer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:S,canvas:B,visible:!0,opacity:100,blendMode:"normal",locked:!1};return T({layers:[...g,q]}),k(q.id,B),q},se=()=>g.find(S=>S.id===R)||null,ne=()=>{const S=D.current,A=u.current;if(!(!S||!A)){if(A.clearRect(0,0,S.width,S.height),F){const B=S.getBoundingClientRect();A.drawImage(F,0,0,B.width,B.height)}g.forEach(B=>{B.visible&&B.canvas&&(A.save(),A.globalAlpha=B.opacity/100,A.globalCompositeOperation=B.blendMode,A.drawImage(B.canvas,0,0),A.restore())})}};n.useEffect(()=>{const S=D.current;if(!S)return;const A=S.getBoundingClientRect();S.width=A.width*window.devicePixelRatio,S.height=A.height*window.devicePixelRatio;const B=S.getContext("2d");B&&(B.scale(window.devicePixelRatio,window.devicePixelRatio),B.lineCap="round",B.lineJoin="round",u.current=B,ne())},[y,H,F,g]);const Se=S=>{if(!N||!u.current)return;const A=se();if(!A||A.locked)return;r(!0);const B=S.currentTarget.getBoundingClientRect(),q=S.clientX-B.left,te=S.clientY-B.top,V=A.canvas.getContext("2d");V&&(V.beginPath(),V.moveTo(q,te),V.lineCap="round",V.lineJoin="round",V.lineWidth=H,O==="eraser"?V.globalCompositeOperation="destination-out":(V.globalCompositeOperation="source-over",V.strokeStyle=y),V.globalAlpha=me/100)},Ce=S=>{if(!o||!N)return;const A=D.current;if(!A)return;const B=A.getBoundingClientRect(),q=S.clientX-B.left,te=S.clientY-B.top;if(O.startsWith("ai-"))Ee(q,te);else{const V=se();if(V&&!V.locked){const ee=V.canvas.getContext("2d");ee&&(ee.lineTo(q,te),ee.stroke(),ne())}}},ve=()=>{if(!u.current)return;const S=se();if(S){const A=S.canvas.getContext("2d");A==null||A.closePath()}r(!1)},De=S=>{S.preventDefault();const A=S.touches[0],B=new MouseEvent("mousedown",{clientX:A.clientX,clientY:A.clientY});Se(B)},Te=S=>{S.preventDefault();const A=S.touches[0],B=new MouseEvent("mousemove",{clientX:A.clientX,clientY:A.clientY});Ce(B)},Be=S=>{S.preventDefault(),ve()},Ee=async(S,A)=>{var te;if(!o||!N||!u.current)return;const B=se();if(!B||B.locked)return;const q={x:Math.max(0,S-50),y:Math.max(0,A-50),width:100,height:100};X(!0);try{const V=(te=D.current)==null?void 0:te.toDataURL();if(!V)return;const ee=await fetch("/api/anime-chara/ai-draw",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageData:V,mode:O.replace("ai-",""),strength:pe,region:q})});if(!ee.ok)throw new Error("AI drawing failed");const fe=await ee.json(),ce=ge("AI Drawing");if(ce){const ye=new Image;ye.onload=()=>{const de=ce.canvas.getContext("2d");de&&(de.drawImage(ye,0,0),ne())},ye.src=`data:image/png;base64,${fe.imageData}`}}catch(V){console.error("AI drawing failed:",V)}finally{X(!1)}};return n.useImperativeHandle(f,()=>({loadOutline:S=>{const A=new Image;A.onload=()=>{const B=D.current;if(!B)return;const q=B.getContext("2d");q&&q.drawImage(A,0,0)},A.src=S},saveDrawing:()=>{var S;return((S=D.current)==null?void 0:S.toDataURL())||""},clearCanvas:()=>{const S=D.current,A=u.current;!S||!A||(A.clearRect(0,0,S.width,S.height),ne())},setDrawingMode:S=>{t(S)},exportLayers:()=>g,importLayers:S=>{T({layers:S}),ne()},regenerateRegion:async S=>{X(!0);try{}catch(A){console.error("Region regeneration failed:",A)}finally{X(!1)}},getCanvas:()=>D.current,undo:()=>{},redo:()=>{}})),w==="ai-generate"?e("div",{className:"canvas-area",children:a("div",{className:"ai-generate-placeholder",children:[e("h2",{children:"AI Generation Mode"}),e("p",{children:"Select options from the right panel to generate your character"})]})}):a("div",{className:"canvas-area",children:[a("div",{className:"drawing-tools",children:[e("button",{className:`tool-button ${O==="brush"?"active":""}`,onClick:()=>Q("brush"),title:"Brush",children:e(lt,{size:20})}),e("button",{className:`tool-button ${O==="eraser"?"active":""}`,onClick:()=>Q("eraser"),title:"Eraser",children:e(ot,{size:20})}),e("div",{className:"tool-separator"}),a("div",{className:"color-picker",children:[e(Ye,{size:20}),e("input",{type:"color",value:y,onChange:S=>_(S.target.value),title:"Color"})]}),a("div",{className:"size-slider",children:[e(Va,{size:20}),e("input",{type:"range",min:"1",max:"50",value:H,onChange:S=>$(parseInt(S.target.value)),title:"Size"})]}),e("button",{className:"tool-button",onClick:()=>{ne(),T({hasDrawing:!1})},title:"Clear Canvas",children:e(Me,{size:20})})]}),e("canvas",{ref:D,onMouseDown:Se,onMouseMove:Ce,onMouseUp:ve,onMouseLeave:ve,onTouchStart:De,onTouchMove:Te,onTouchEnd:Be,className:"drawing-canvas",style:{cursor:K?"wait":"crosshair"}}),le&&a("div",{className:"reference-image-container",children:[e("img",{src:le,alt:"Reference"}),e("button",{className:"close-reference",onClick:()=>Y(null),title:"Close Reference",children:e(ue,{size:20})})]}),Re&&e(We,{onSelect:S=>{Y(S),re(!1)},onClose:()=>re(!1)})]})});wa.displayName="CanvasArea";const yt=({layers:i,activeLayerId:f,onAddLayer:w,onUpdateLayer:z,onDeleteLayer:v,onSelectLayer:b})=>a("div",{className:"layers-panel",children:[a("div",{className:"layers-header",children:[e("h3",{children:"Layers"}),e("button",{className:"add-layer-btn",onClick:w,title:"Add new layer",children:e(qe,{size:20})})]}),e("div",{className:"layers-list",children:i.map(p=>a("div",{className:`layer-item ${p.id===f?"active":""}`,onClick:()=>b(p.id),children:[a("div",{className:"layer-controls",children:[e("button",{className:`visibility-btn ${p.visible?"visible":""}`,onClick:m=>{m.stopPropagation(),z(p.id,{visible:!p.visible})},title:p.visible?"Hide layer":"Show layer",children:p.visible?e(Ae,{size:16}):e(Oa,{size:16})}),e("button",{className:`lock-btn ${p.locked?"locked":""}`,onClick:m=>{m.stopPropagation(),z(p.id,{locked:!p.locked})},title:p.locked?"Unlock layer":"Lock layer",children:p.locked?e(Ga,{size:16}):e(_a,{size:16})})]}),e("input",{type:"text",value:p.name,onChange:m=>z(p.id,{name:m.target.value}),onClick:m=>m.stopPropagation(),className:"layer-name-input"}),a("div",{className:"layer-settings",children:[e("input",{type:"range",min:"0",max:"100",value:p.opacity,onChange:m=>z(p.id,{opacity:parseInt(m.target.value)}),onClick:m=>m.stopPropagation(),className:"opacity-slider",title:`Opacity: ${p.opacity}%`}),a("select",{value:p.blendMode,onChange:m=>z(p.id,{blendMode:m.target.value}),onClick:m=>m.stopPropagation(),className:"blend-mode-select",children:[e("option",{value:"normal",children:"Normal"}),e("option",{value:"multiply",children:"Multiply"}),e("option",{value:"screen",children:"Screen"}),e("option",{value:"overlay",children:"Overlay"}),e("option",{value:"darken",children:"Darken"}),e("option",{value:"lighten",children:"Lighten"})]}),i.length>1&&e("button",{className:"delete-btn",onClick:m=>{m.stopPropagation(),v(p.id)},title:"Delete layer",children:e(Me,{size:16})})]})]},p.id))})]}),bt=({color:i,onColorChange:f})=>{const[w,z]=n.useState(["#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#808080"]);return a("div",{className:"palette-panel",children:[a("div",{className:"palette-header",children:[e("h3",{children:"Color Palette"}),e("button",{className:"add-color-btn",onClick:()=>{w.includes(i)||z(b=>[...b,i])},title:"Add current color",children:e(qe,{size:20})})]}),a("div",{className:"color-picker",children:[e("input",{type:"color",value:i,onChange:b=>f(b.target.value),className:"color-input"}),e("div",{className:"color-preview",style:{backgroundColor:i},children:e("span",{children:i.toUpperCase()})})]}),a("div",{className:"saved-colors",children:[e("h4",{children:"Saved Colors"}),e("div",{className:"color-grid",children:w.map((b,p)=>e("button",{className:"color-swatch",style:{backgroundColor:b},onClick:()=>f(b),title:b},p))})]}),a("div",{className:"color-sliders",children:[a("div",{className:"slider-group",children:[e("label",{children:"Red"}),e("input",{type:"range",min:"0",max:"255",value:parseInt(i.slice(1,3),16),onChange:b=>{const p=b.target.value.padStart(2,"0"),m=i.slice(3,5),h=i.slice(5,7);f(`#${p}${m}${h}`)}})]}),a("div",{className:"slider-group",children:[e("label",{children:"Green"}),e("input",{type:"range",min:"0",max:"255",value:parseInt(i.slice(3,5),16),onChange:b=>{const p=i.slice(1,3),m=b.target.value.padStart(2,"0"),h=i.slice(5,7);f(`#${p}${m}${h}`)}})]}),a("div",{className:"slider-group",children:[e("label",{children:"Blue"}),e("input",{type:"range",min:"0",max:"255",value:parseInt(i.slice(5,7),16),onChange:b=>{const p=i.slice(1,3),m=i.slice(3,5),h=b.target.value.padStart(2,"0");f(`#${p}${m}${h}`)}})]})]})]})},Nt=()=>a("div",{className:"history-panel",children:[a("div",{className:"history-header",children:[e("h3",{children:"History"}),a("div",{className:"history-controls",children:[e("button",{className:"undo-btn",title:"Undo",children:e(Ya,{size:20})}),e("button",{className:"redo-btn",title:"Redo",children:e(ja,{size:20})})]})]}),a("div",{className:"history-list",children:[a("div",{className:"history-item",children:[e("span",{className:"history-action",children:"Added Layer"}),e("span",{className:"history-time",children:"Just now"})]}),a("div",{className:"history-item",children:[e("span",{className:"history-action",children:"Changed Color"}),e("span",{className:"history-time",children:"2m ago"})]}),a("div",{className:"history-item",children:[e("span",{className:"history-action",children:"Drew Line"}),e("span",{className:"history-time",children:"5m ago"})]})]})]}),ka=()=>{const[i,f]=n.useState("png"),[w,z]=n.useState(90),[v,b]=n.useState(100);return a("div",{className:"export-panel",children:[e("div",{className:"export-header",children:e("h3",{children:"Export"})}),a("div",{className:"export-settings",children:[a("div",{className:"setting-group",children:[e("label",{children:"Format"}),a("select",{value:i,onChange:m=>f(m.target.value),className:"format-select",children:[e("option",{value:"png",children:"PNG"}),e("option",{value:"jpg",children:"JPEG"}),e("option",{value:"webp",children:"WebP"}),e("option",{value:"svg",children:"SVG"})]})]}),i==="jpg"&&a("div",{className:"setting-group",children:[a("label",{children:["Quality (",w,"%)"]}),e("input",{type:"range",min:"1",max:"100",value:w,onChange:m=>z(parseInt(m.target.value)),className:"quality-slider"})]}),a("div",{className:"setting-group",children:[a("label",{children:["Size (",v,"%)"]}),e("input",{type:"range",min:"1",max:"400",value:v,onChange:m=>b(parseInt(m.target.value)),className:"size-slider"})]})]}),a("div",{className:"export-actions",children:[a("button",{className:"export-btn primary",onClick:()=>{console.log("Exporting with settings:",{format:i,quality:w,size:v})},children:[e(ba,{size:20}),"Export"]}),a("button",{className:"export-btn",children:[e(qa,{size:20}),"Share"]}),a("button",{className:"export-btn",children:[e(Wa,{size:20}),"Copy"]})]}),a("div",{className:"export-preview",children:[e("h4",{children:"Preview"}),e("div",{className:"preview-container",children:e("div",{className:"preview-placeholder",children:"Preview not available"})})]})]})},we={Popular:["gorgeous-anime","manga-sketch","semi-realistic","kawaii-moe"],Classic:["chibi","bishojo","shonen","magical-girl","shoujo-sparkle"],Modern:["cyberpunk-neon","minimalist-clean","pixel-art","watercolor-soft"],Atmospheric:["gothic-lolita","dark-fantasy","horror-creepy","vintage-retro"],Lifestyle:["sports-dynamic","slice-of-life","mecha-girl"]},St=({onComplete:i,designBrief:f})=>{const[w,z]=n.useState([]),[v,b]=n.useState(null),[p,m]=n.useState(!0),[h,L]=n.useState(null),[I,T]=n.useState("Popular"),[g,R]=n.useState(""),[k,P]=n.useState(!1);n.useEffect(()=>{c()},[]);const c=async()=>{try{const r=await fetch("/api/anime-chara/templates",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!r.ok)throw new Error("Failed to fetch templates");const N=await r.json();z(N.templates||[])}catch(r){L(r instanceof Error?r.message:"Failed to load templates")}finally{m(!1)}},D=r=>{b(r),k&&i({template:r})},u=()=>{v&&i({template:v})},C=()=>{let r=w;return I&&we[I]&&(r=r.filter(N=>we[I].includes(N.id))),g&&(r=r.filter(N=>N.name.toLowerCase().includes(g.toLowerCase())||N.style.toLowerCase().includes(g.toLowerCase())||N.characteristics.some(t=>t.toLowerCase().includes(g.toLowerCase())))),r},E=r=>({"gorgeous-anime":"✨","manga-sketch":"🖤","semi-realistic":"🎨","kawaii-moe":"💖","cyberpunk-neon":"🌆","gothic-lolita":"🖤","shoujo-sparkle":"🌸","pixel-art":"🎮","watercolor-soft":"🎨","minimalist-clean":"⚪","vintage-retro":"📻","dark-fantasy":"🌙","sports-dynamic":"⚡","slice-of-life":"☀️","horror-creepy":"👻",chibi:"🥰",bishojo:"🌺",shonen:"💪","mecha-girl":"🤖","magical-girl":"🪄"})[r]||"🎭";if(p)return e("div",{className:"template-library loading",children:a("div",{className:"loading-spinner",children:[e("div",{className:"spinner-icon",children:"🎭"}),e("p",{children:"Loading enhanced art styles..."})]})});if(h)return a("div",{className:"template-library error",children:[a("div",{className:"error-message",children:["⚠️ ",h]}),e("button",{onClick:c,className:"retry-btn",children:"Try Again"})]});const o=C();return a("div",{className:"template-library enhanced",children:[a("div",{className:"library-header",children:[e("h2",{children:"🎭 Enhanced Style Presets"}),a("p",{children:["Choose from ",w.length," professional anime styles with one-click switching"]}),e("div",{className:"preview-controls",children:a("label",{className:"preview-toggle",children:[e("input",{type:"checkbox",checked:k,onChange:r=>P(r.target.checked)}),e("span",{className:"toggle-slider"}),"Live Preview Mode"]})})]}),a("div",{className:"library-controls",children:[a("div",{className:"search-bar",children:[e("input",{type:"text",placeholder:"Search styles... (e.g., 'realistic', 'cute', 'dark')",value:g,onChange:r=>R(r.target.value),className:"search-input"}),e("span",{className:"search-icon",children:"🔍"})]}),a("div",{className:"category-tabs",children:[Object.keys(we).map(r=>a("button",{className:`category-tab ${I===r?"active":""}`,onClick:()=>T(r),children:[r,a("span",{className:"category-count",children:["(",we[r].filter(N=>w.some(t=>t.id===N)).length,")"]})]},r)),a("button",{className:`category-tab ${I==="All"?"active":""}`,onClick:()=>T("All"),children:["All (",w.length,")"]})]})]}),f&&a("div",{className:"character-preview",children:[a("h3",{children:["Your Character: ",f.character.name||"Unnamed"]}),a("div",{className:"character-info",children:[a("span",{children:[e("strong",{children:"Personality:"})," ",f.character.personality]}),a("span",{children:[e("strong",{children:"Mood:"})," ",f.mood]})]})]}),e("div",{className:"templates-grid enhanced",children:o.map(r=>a("div",{className:`template-card enhanced ${(v==null?void 0:v.id)===r.id?"selected":""}`,onClick:()=>D(r),children:[a("div",{className:"template-preview",children:[e("div",{className:"template-icon",children:E(r.id)}),e("div",{className:"template-overlay",children:e("span",{className:"preview-text",children:k?"Click to Apply":"Click to Select"})})]}),a("div",{className:"template-info",children:[a("div",{className:"template-header",children:[e("h3",{children:r.name}),e("div",{className:"style-badge",children:r.style})]}),e("p",{className:"template-description",children:r.description}),e("div",{className:"template-features",children:a("div",{className:"features-list",children:[r.characteristics.slice(0,3).map((N,t)=>e("span",{className:"feature-tag",children:N},t)),r.characteristics.length>3&&a("span",{className:"feature-more",children:["+",r.characteristics.length-3," more"]})]})}),e("div",{className:"template-proportions compact",children:a("div",{className:"proportion-indicator",children:[a("span",{children:["Head: ",Math.round(r.proportions.headRatio*100),"%"]}),a("span",{children:["Body: ",Math.round(r.proportions.bodyRatio*100),"%"]})]})})]}),k&&e("div",{className:"quick-apply",children:e("button",{className:"apply-btn",children:"✨ Apply Style"})})]},r.id))}),o.length===0&&a("div",{className:"no-results",children:[e("div",{className:"no-results-icon",children:"🎭"}),e("h3",{children:"No styles found"}),e("p",{children:"Try adjusting your search or selecting a different category"})]}),v&&!k&&a("div",{className:"template-selection enhanced",children:[a("div",{className:"selected-template-info",children:[a("div",{className:"selection-header",children:[e("span",{className:"selection-icon",children:E(v.id)}),a("div",{children:[a("h3",{children:["Selected: ",v.name]}),e("p",{children:v.description})]})]}),a("div",{className:"style-characteristics",children:[e("h4",{children:"Style Features:"}),e("div",{className:"characteristics-grid",children:v.characteristics.map((r,N)=>e("span",{className:"characteristic-pill",children:r},N))})]})]}),a("button",{onClick:u,className:"continue-btn enhanced",children:["Continue with ",v.name," ➡️"]})]})]})},_e=[{id:"confident_stand",name:"Confident Stand",description:"Standing with hands on hips, confident pose",preview:"🧍‍♀️",category:"standing"},{id:"energetic_jump",name:"Energetic Jump",description:"Mid-jump with arms raised, full of energy",preview:"🤸‍♀️",category:"action"},{id:"relaxed_sitting",name:"Relaxed Sitting",description:"Sitting casually with a relaxed posture",preview:"🪑",category:"sitting"},{id:"happy_smile",name:"Happy Smile",description:"Bright, genuine smile with sparkling eyes",preview:"😊",category:"expression"},{id:"surprised_gasp",name:"Surprised Gasp",description:"Wide eyes and open mouth, surprised expression",preview:"😲",category:"expression"},{id:"mischievous_smirk",name:"Mischievous Smirk",description:"Slight smirk with a playful glint in the eyes",preview:"😏",category:"expression"},{id:"determined_fist",name:"Determined Fist",description:"Clenched fist raised, showing determination",preview:"✊",category:"action"},{id:"peaceful_meditation",name:"Peaceful Meditation",description:"Cross-legged sitting in peaceful meditation",preview:"🧘‍♀️",category:"sitting"}],Ct=({selectedPose:i,onPoseSelect:f,onClose:w})=>{const[z,v]=n.useState("all"),b=[{id:"all",name:"All Poses",icon:"🎭"},{id:"standing",name:"Standing",icon:"🧍‍♀️"},{id:"action",name:"Action",icon:"🤸‍♀️"},{id:"sitting",name:"Sitting",icon:"🪑"},{id:"expression",name:"Expression",icon:"😊"}],p=z==="all"?_e:_e.filter(h=>h.category===z),m=h=>{switch(h){case"standing":return"🧍‍♀️";case"action":return"🤸‍♀️";case"sitting":return"🪑";case"expression":return"😊";default:return"🎭"}};return e("div",{className:"pose-library-modal",children:a("div",{className:"pose-library-content",children:[a("div",{className:"pose-library-header",children:[e("h3",{children:"🎭 Pose Library"}),e("button",{className:"close-btn",onClick:w,children:"×"})]}),e("div",{className:"category-tabs",children:b.map(h=>a("button",{className:`category-tab ${z===h.id?"active":""}`,onClick:()=>v(h.id),children:[e("span",{className:"category-icon",children:h.icon}),e("span",{className:"category-name",children:h.name})]},h.id))}),e("div",{className:"poses-grid",children:p.map(h=>a("div",{className:`pose-card ${i.id===h.id?"selected":""}`,onClick:()=>f(h),children:[e("div",{className:"pose-preview",children:e("span",{className:"pose-emoji",children:h.preview})}),a("div",{className:"pose-info",children:[e("h4",{className:"pose-name",children:h.name}),e("p",{className:"pose-description",children:h.description}),a("span",{className:"pose-category",children:[m(h.category)," ",h.category]})]})]},h.id))}),e("div",{className:"pose-actions",children:e("button",{onClick:()=>f(i),className:"confirm-pose-btn",children:"✅ Use Selected Pose"})})]})})},Le=[{id:"yumi-1",src:"/references/yumi-1.png",title:"Yumi Madi Style",description:"Classic Yumi character design with signature style",tags:["classic","signature","character-design"]},{id:"yumi-2",src:"/references/yumi-2.png",title:"Yumi Sort Style",description:"Alternative Yumi design with unique styling",tags:["alternative","unique","styling"]},{id:"yumi-3",src:"/references/yumi-3.png",title:"Yumi with Bubble Tea",description:"Yumi enjoying bubble tea - casual scene reference",tags:["casual","bubble-tea","lifestyle","scene"]}],He=i=>Le.filter(f=>f.tags.includes(i)),wt=[{id:"all",label:"All References",count:Le.length},{id:"classic",label:"Classic Designs",count:He("classic").length},{id:"casual",label:"Casual Scenes",count:He("casual").length},{id:"alternative",label:"Alternative Styles",count:He("alternative").length}],kt=`
All Yumi reference images are AI-generated original content owned by our platform. 
These images are provided for drawing reference and inspiration purposes only.
By using these references, you agree to respect the original artistic style and intent.
`;Array.from({length:7},(i,f)=>({id:`yumi-${f+4}`,src:`/references/yumi-${f+4}.png`,title:`Yumi Reference ${f+4}`,description:"Future reference image - coming soon!",tags:["coming-soon"]}));const xa=({onClose:i,onSelect:f})=>{const[w,z]=n.useState(!1),[v,b]=n.useState(null),[p,m]=n.useState("all"),[h,L]=n.useState(null),[I,T]=n.useState(null),g=n.useRef(null),R=u=>{var o;const C=(o=u.target.files)==null?void 0:o[0];if(!C)return;if(!C.type.startsWith("image/")){alert("Please select an image file.");return}if(C.size>10*1024*1024){alert("File size must be less than 10MB.");return}T(C);const E=URL.createObjectURL(C);b(E)},k=async()=>{if(I)try{const u=new FormData;u.append("artwork",I);const C=await fetch("/api/art/upload",{method:"POST",body:u,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(C.ok){const E=await C.json();alert(`🎉 Thanks for sharing! Your artwork has been submitted for review.

🎁 Reward: You'll receive 1000 timeshards once approved!
💫 First contribution bonus: +500 extra timeshards!`)}else throw new Error("Upload failed");z(!1),b(null),T(null),g.current&&(g.current.value="")}catch(u){console.error("Upload failed:",u),alert("Upload failed. Please try again later.")}},P=u=>{f(u.src),i()},c=u=>{L(u)},D=p==="all"?Le:Le.filter(u=>u.tags.includes(p));return e("div",{className:"yumi-reference-modal-overlay",onClick:i,children:a("div",{className:"yumi-reference-modal",onClick:u=>u.stopPropagation(),children:[a("div",{className:"modal-header",children:[a("div",{className:"header-content",children:[e("h2",{children:"🎨 Yumi Reference Library"}),e("p",{className:"header-subtitle",children:"AI-generated Yumi images for drawing reference and inspiration"})]}),e("button",{onClick:i,className:"close-button",children:e(ue,{size:24})})]}),e("div",{className:"category-filter",children:wt.map(u=>a("button",{className:`category-btn ${p===u.id?"active":""}`,onClick:()=>m(u.id),children:[u.label,a("span",{className:"count",children:["(",u.count,")"]})]},u.id))}),e("div",{className:"reference-grid",children:D.map(u=>a("div",{className:"reference-item",children:[a("div",{className:"reference-image-container",children:[e("img",{src:u.src,alt:u.title,className:"reference-image",onError:C=>{C.target.src="/placeholder-yumi.png"}}),a("div",{className:"reference-overlay",children:[e("button",{className:"overlay-btn preview-btn",onClick:()=>c(u),title:"Preview",children:e(Ae,{size:20})}),e("button",{className:"overlay-btn select-btn",onClick:()=>P(u),title:"Use as Reference",children:e(xe,{size:20})})]})]}),a("div",{className:"reference-info",children:[e("h4",{children:u.title}),e("p",{children:u.description}),e("div",{className:"reference-tags",children:u.tags.map(C=>e("span",{className:"tag",children:C},C))})]})]},u.id))}),a("div",{className:"share-art-section",children:[e("div",{className:"section-divider",children:e("span",{children:"Share Your Art"})}),w?a("div",{className:"upload-section",children:[e("h3",{children:"Upload Your Artwork"}),a("p",{className:"upload-description",children:["Share your original Yumi-inspired artwork with our community. By uploading, you agree to our terms and may allow us to feature your art.",e("br",{}),e("strong",{children:"🎁 Earn 1000+ timeshards for approved contributions!"})]}),v&&a("div",{className:"file-preview",children:[e("img",{src:v,alt:"Upload preview",className:"preview-image"}),a("div",{className:"preview-info",children:[e("p",{children:e("strong",{children:I==null?void 0:I.name})}),a("p",{children:["Size: ",I?(I.size/1024).toFixed(1):0," KB"]})]})]}),e("input",{type:"file",ref:g,accept:"image/*",onChange:R,className:"file-input"}),a("div",{className:"upload-actions",children:[a("button",{onClick:()=>{var u;return(u=g.current)==null?void 0:u.click()},className:"select-file-btn",children:[e(xe,{size:20}),v?"Change Image":"Select Image"]}),v&&a("button",{onClick:k,className:"upload-submit-btn",children:[e(Pe,{size:20}),"Upload & Share"]}),e("button",{onClick:()=>{z(!1),b(null),T(null),g.current&&(g.current.value="")},className:"cancel-btn",children:"Cancel"})]})]}):a("div",{className:"share-invitation",children:[e(Ja,{className:"heart-icon",size:32}),e("h3",{children:"Love creating Yumi art?"}),e("p",{children:"We'd love to see your original artwork! Share your creations with our community and earn rewards."}),a("div",{className:"reward-info",children:[a("div",{className:"reward-item",children:[e("span",{className:"reward-icon",children:"🎁"}),a("span",{className:"reward-text",children:[e("strong",{children:"1000 timeshards"})," for approved artwork"]})]}),a("div",{className:"reward-item",children:[e("span",{className:"reward-icon",children:"💫"}),a("span",{className:"reward-text",children:[e("strong",{children:"+500 bonus"})," for your first contribution"]})]}),a("div",{className:"reward-item",children:[e("span",{className:"reward-icon",children:"⭐"}),a("span",{className:"reward-text",children:[e("strong",{children:"+250 bonus"})," for exceptional quality"]})]})]}),a("button",{onClick:()=>z(!0),className:"share-btn",children:[e(Pe,{size:20}),"Share Your Original Art"]})]})]}),e("div",{className:"legal-disclaimer",children:e("small",{children:kt})}),h&&e("div",{className:"preview-modal-overlay",onClick:()=>L(null),children:a("div",{className:"preview-modal",onClick:u=>u.stopPropagation(),children:[a("div",{className:"preview-header",children:[e("h3",{children:h.title}),e("button",{onClick:()=>L(null),className:"close-button",children:e(ue,{size:20})})]}),a("div",{className:"preview-content",children:[e("img",{src:h.src,alt:h.title,className:"preview-full-image"}),a("div",{className:"preview-details",children:[e("p",{children:h.description}),e("div",{className:"preview-tags",children:h.tags.map(u=>e("span",{className:"tag",children:u},u))}),a("button",{onClick:()=>P(h),className:"use-reference-btn",children:[e(xe,{size:20}),"Use as Reference"]})]})]})]})})]})})},xt=({library:i,onSelect:f,onSave:w,onDelete:z,onDuplicate:v,onVersionSelect:b,onClose:p,currentCharacter:m})=>{const[h,L]=n.useState(!1),[I,T]=n.useState(""),[g,R]=n.useState(""),[k,P]=n.useState(null),[c,D]=n.useState("grid"),[u,C]=n.useState("");n.useRef(null);const E=()=>{I.trim()&&(w(I.trim(),g.trim()),T(""),R(""),L(!1))},o=(t,d)=>{t.dataTransfer.setData("application/json",JSON.stringify(d)),t.dataTransfer.effectAllowed="copy"},r=i.filter(t=>u?t.tags.some(d=>d.toLowerCase().includes(u.toLowerCase())):!0),N=Array.from(new Set(i.flatMap(t=>t.tags)));return a("div",{className:"character-library",children:[a("div",{className:"library-header",children:[e("h3",{children:"🎭 Character Library"}),a("div",{className:"header-actions",children:[a("button",{className:"save-btn",onClick:()=>L(!0),title:"Save Current Character",children:[e(qe,{})," Save Current"]}),e("button",{className:"close-btn",onClick:p,children:e(ue,{})})]})]}),a("div",{className:"library-controls",children:[e("div",{className:"filter-section",children:a("select",{value:u,onChange:t=>C(t.target.value),className:"filter-select",children:[e("option",{value:"",children:"All Tags"}),N.map(t=>e("option",{value:t,children:t},t))]})}),a("div",{className:"view-controls",children:[e("button",{className:c==="grid"?"active":"",onClick:()=>D("grid"),children:"Grid"}),e("button",{className:c==="list"?"active":"",onClick:()=>D("list"),children:"List"})]})]}),e("div",{className:`library-content ${c}`,children:r.map(t=>a("div",{className:`library-item ${(m==null?void 0:m.id)===t.id?"active":""}`,draggable:!0,onDragStart:d=>o(d,t),onClick:()=>P(t),children:[a("div",{className:"item-thumbnail",children:[e("img",{src:t.thumbnail,alt:t.name}),a("div",{className:"version-indicator",children:[t.versions.length," versions"]})]}),a("div",{className:"item-info",children:[e("h4",{children:t.name}),e("div",{className:"item-tags",children:t.tags.map(d=>e("span",{className:"tag",children:d},d))}),e("div",{className:"item-date",children:new Date(t.lastModified).toLocaleDateString()})]}),a("div",{className:"item-actions",children:[e("button",{onClick:d=>{d.stopPropagation(),f(t)},title:"Load Character",children:e(Ae,{})}),e("button",{onClick:d=>{d.stopPropagation(),v(t)},title:"Duplicate",children:e(Na,{})}),e("button",{onClick:d=>{d.stopPropagation(),z(t.id)},title:"Delete",className:"delete-btn",children:e(Me,{})})]})]},t.id))}),k&&e("div",{className:"character-detail-modal",children:a("div",{className:"modal-content",children:[a("div",{className:"modal-header",children:[e("h3",{children:k.name}),e("button",{onClick:()=>P(null),children:e(ue,{})})]}),a("div",{className:"versions-section",children:[a("h4",{children:["Versions (",k.versions.length,")"]}),e("div",{className:"versions-grid",children:k.versions.map(t=>a("div",{className:`version-item ${t.id===k.activeVersionId?"active":""}`,onClick:()=>b(k.id,t.id),children:[e("img",{src:t.thumbnail,alt:t.name}),a("div",{className:"version-info",children:[e("span",{className:"version-name",children:t.name}),e("span",{className:"version-date",children:new Date(t.timestamp).toLocaleDateString()})]})]},t.id))})]})]})}),h&&e("div",{className:"save-dialog-overlay",children:a("div",{className:"save-dialog",children:[e("h3",{children:"Save Character"}),a("div",{className:"form-group",children:[e("label",{children:"Character Name"}),e("input",{type:"text",value:I,onChange:t=>T(t.target.value),placeholder:"Enter character name...",autoFocus:!0})]}),a("div",{className:"form-group",children:[e("label",{children:"Description (Optional)"}),e("textarea",{value:g,onChange:t=>R(t.target.value),placeholder:"Add a description...",rows:3})]}),a("div",{className:"dialog-actions",children:[e("button",{onClick:()=>L(!1),children:"Cancel"}),e("button",{onClick:E,disabled:!I.trim(),children:"Save Character"})]})]})})]})},zt=({onColorSelect:i,onPaletteSelect:f,currentImage:w,onAnalyze:z})=>{const[v,b]=n.useState(!1),[p,m]=n.useState(null),[h,L]=n.useState([]),[I,T]=n.useState("all"),[g,R]=n.useState(null),k=n.useRef(null),P=o=>{var N;const r=(N=o.target.files)==null?void 0:N[0];if(r){const t=new FileReader;t.onload=d=>{var F;const M=(F=d.target)==null?void 0:F.result;R(M),c(M)},t.readAsDataURL(r)}},c=async o=>{b(!0);try{const r=await z(o);m(r),D(r)}catch(r){console.error("Failed to analyze image:",r)}finally{b(!1)}},D=o=>{const r=[];o.dominantColors.forEach((N,t)=>{r.push({color:N,reason:`Dominant color ${t+1} from your image`,category:"base",compatibility:95-t*5})}),o.recommendations.accentColors.forEach((N,t)=>{r.push({color:N,reason:`${o.colorHarmony} harmony accent`,category:"accent",compatibility:90-t*3})}),o.recommendations.hairColor.forEach((N,t)=>{r.push({color:N,reason:"Hair color suggestion",category:"highlight",compatibility:85-t*2})}),o.dominantColors.forEach(N=>{const t=u(N,-30);r.push({color:t,reason:"Shadow variant for depth",category:"shadow",compatibility:80})}),L(r)},u=(o,r)=>{const N=o.replace("#",""),t=parseInt(N,16),d=Math.max(0,Math.min(255,(t>>16)+r)),M=Math.max(0,Math.min(255,(t>>8&255)+r)),F=Math.max(0,Math.min(255,(t&255)+r));return`#${(d<<16|M<<8|F).toString(16).padStart(6,"0")}`},C=I==="all"?h:h.filter(o=>o.category===I),E=[{id:"maid_cafe",name:"Maid Café",colors:["#1a1a2e","#16213e","#0f3460","#533483","#7209b7"],category:"theme",theme:"maid_cafe"},{id:"sakura_spring",name:"Sakura Spring",colors:["#ffb7c5","#ffc0cb","#ff69b4","#ff1493","#c71585"],category:"pastel"},{id:"ocean_breeze",name:"Ocean Breeze",colors:["#4facfe","#00f2fe","#43e97b","#38f9d7","#667eea"],category:"cool"},{id:"sunset_warm",name:"Sunset Warm",colors:["#ff6b9d","#c44569","#f8b500","#feca57","#ff9ff3"],category:"warm"},{id:"gothic_dark",name:"Gothic Dark",colors:["#1a1a2e","#16213e","#533483","#7209b7","#2d1b69"],category:"theme",theme:"gothic"}];return a("div",{className:"ai-color-assistant",children:[a("div",{className:"assistant-header",children:[e("h3",{children:"🎨 AI Color Assistant"}),a("div",{className:"header-actions",children:[a("button",{onClick:()=>{var o;return(o=k.current)==null?void 0:o.click()},className:"upload-btn",disabled:v,children:[e(Za,{})," Upload Reference"]}),(w||g)&&a("button",{onClick:()=>c(w||g),className:"analyze-btn",disabled:v,children:[e(Ie,{})," ",v?"Analyzing...":"Re-analyze"]})]})]}),e("input",{ref:k,type:"file",accept:"image/*",onChange:P,style:{display:"none"}}),v&&a("div",{className:"analysis-status",children:[e("div",{className:"loading-spinner"}),e("span",{children:"Analyzing colors and harmony..."})]}),(g||w)&&a("div",{className:"image-preview",children:[e("img",{src:g||w,alt:"Reference"}),e("div",{className:"image-overlay",children:e(Ae,{})})]}),p&&a("div",{className:"analysis-results",children:[e("h4",{children:"🔍 Analysis Results"}),a("div",{className:"color-harmony",children:[e("span",{className:"harmony-label",children:"Color Harmony:"}),e("span",{className:"harmony-type",children:p.colorHarmony})]}),a("div",{className:"dominant-colors",children:[e("span",{className:"label",children:"Dominant Colors:"}),e("div",{className:"color-row",children:p.dominantColors.map((o,r)=>e("div",{className:"color-swatch",style:{backgroundColor:o},onClick:()=>i(o),title:o},r))})]})]}),h.length>0&&a("div",{className:"category-filter",children:[e("h4",{children:"🎯 AI Suggestions"}),e("div",{className:"filter-buttons",children:["all","base","accent","highlight","shadow"].map(o=>e("button",{className:I===o?"active":"",onClick:()=>T(o),children:o.charAt(0).toUpperCase()+o.slice(1)},o))})]}),C.length>0&&e("div",{className:"ai-suggestions",children:C.map((o,r)=>a("div",{className:"suggestion-item",onClick:()=>i(o.color),children:[e("div",{className:"suggestion-color",style:{backgroundColor:o.color}}),a("div",{className:"suggestion-info",children:[e("div",{className:"suggestion-reason",children:o.reason}),a("div",{className:"suggestion-meta",children:[e("span",{className:"category",children:o.category}),a("span",{className:"compatibility",children:[o.compatibility,"% match"]})]})]})]},r))}),a("div",{className:"predefined-palettes",children:[e("h4",{children:"🎨 Theme Palettes"}),e("div",{className:"palettes-grid",children:E.map(o=>a("div",{className:"palette-item",onClick:()=>f(o),children:[e("div",{className:"palette-colors",children:o.colors.map((r,N)=>e("div",{className:"palette-color",style:{backgroundColor:r}},N))}),e("div",{className:"palette-name",children:o.name})]},o.id))})]}),a("div",{className:"quick-actions",children:[e("button",{onClick:()=>{var o;return(o=navigator.clipboard)==null?void 0:o.writeText(JSON.stringify(p))},children:"Copy Analysis"}),e("button",{onClick:()=>L([]),children:"Clear Suggestions"})]})]})},It=({settings:i,onSettingsChange:f,currentColor:w,onAutoFill:z,isActive:v,onToggle:b})=>{const[p,m]=n.useState(!1),[h,L]=n.useState(!1),I=c=>{f({...i,mode:c})},T=c=>{f({...i,sensitivity:c})},g=c=>{f({...i,blendStrength:c})},R=()=>{f({...i,preserveDetails:!i.preserveDetails})},k=[{id:"auto_fill",name:"Auto Fill",icon:e(Xa,{}),description:"Automatically fills detected regions with color",features:["Region detection","Smart boundaries","Color preservation"]},{id:"gradient_fill",name:"Gradient Fill",icon:e(Ie,{}),description:"Creates intelligent gradients based on lighting and form",features:["Light analysis","Form following","Natural transitions"]},{id:"pattern_recognition",name:"Pattern Recognition",icon:e(na,{}),description:"Detects and fills patterns like clothes folds, hair strands",features:["Pattern recognition","Texture matching","Detail enhancement"]}],P=[{name:"Clothing",config:{mode:"auto_fill",sensitivity:75,blendStrength:85,preserveDetails:!0,detailLevel:"medium",edgeDetection:!0,colorBlending:"smooth"},description:"Optimized for coloring clothes and fabric"},{name:"Hair",config:{mode:"pattern_recognition",sensitivity:60,blendStrength:70,preserveDetails:!0,detailLevel:"fine",edgeDetection:!0,colorBlending:"textured"},description:"Perfect for hair strands and texture"},{name:"Skin",config:{mode:"gradient_fill",sensitivity:85,blendStrength:90,preserveDetails:!0,detailLevel:"ultra-fine",edgeDetection:!0,colorBlending:"smooth"},description:"Natural skin tones and shading"},{name:"Accessories",config:{mode:"auto_fill",sensitivity:90,blendStrength:95,preserveDetails:!1,detailLevel:"coarse",edgeDetection:!1,colorBlending:"crisp"},description:"Clean fills for jewelry and accessories"}];return a("div",{className:"smart-brush-panel",children:[a("div",{className:"panel-header",children:[a("div",{className:"header-left",children:[e("h3",{children:"🎨 Smart Brush"}),a("button",{className:`toggle-btn ${v?"active":""}`,onClick:b,title:v?"Disable Smart Brush":"Enable Smart Brush",children:[e(be,{}),v?"ON":"OFF"]})]}),e("button",{className:"settings-btn",onClick:()=>m(!p),title:"Advanced Settings",children:e(ya,{})})]}),v&&a(la,{children:[a("div",{className:"mode-selection",children:[e("h4",{children:"Brush Mode"}),e("div",{className:"mode-grid",children:k.map(c=>a("div",{className:`mode-card ${i.mode===c.id?"active":""}`,onClick:()=>I(c.id),children:[e("div",{className:"mode-icon",children:c.icon}),a("div",{className:"mode-info",children:[e("div",{className:"mode-name",children:c.name}),e("div",{className:"mode-description",children:c.description}),e("div",{className:"mode-features",children:c.features.map(D=>e("span",{className:"feature-tag",children:D},D))})]})]},c.id))})]}),a("div",{className:"preset-section",children:[e("h4",{children:"Quick Presets"}),e("div",{className:"preset-grid",children:P.map(c=>e("button",{className:"preset-btn",onClick:()=>f(c.config),title:c.description,children:c.name},c.name))})]}),a("div",{className:"main-controls",children:[e("div",{className:"control-group",children:a("label",{children:["Sensitivity: ",i.sensitivity,"%",a("div",{className:"slider-container",children:[e("input",{type:"range",min:"0",max:"100",value:i.sensitivity,onChange:c=>T(parseInt(c.target.value)),className:"slider"}),a("div",{className:"slider-labels",children:[e("span",{children:"Loose"}),e("span",{children:"Precise"})]})]})]})}),e("div",{className:"control-group",children:a("label",{children:["Blend Strength: ",i.blendStrength,"%",a("div",{className:"slider-container",children:[e("input",{type:"range",min:"0",max:"100",value:i.blendStrength,onChange:c=>g(parseInt(c.target.value)),className:"slider"}),a("div",{className:"slider-labels",children:[e("span",{children:"Subtle"}),e("span",{children:"Strong"})]})]})]})}),e("div",{className:"control-group",children:a("label",{className:"checkbox-label",children:[e("input",{type:"checkbox",checked:i.preserveDetails,onChange:R}),e("span",{className:"checkmark"}),"Preserve Fine Details"]})})]}),p&&a("div",{className:"advanced-settings",children:[e("h4",{children:"Advanced Settings"}),a("div",{className:"advanced-grid",children:[a("div",{className:"setting-item",children:[e("label",{children:"Edge Detection"}),a("select",{defaultValue:"canny",children:[e("option",{value:"canny",children:"Canny"}),e("option",{value:"sobel",children:"Sobel"}),e("option",{value:"prewitt",children:"Prewitt"})]})]}),a("div",{className:"setting-item",children:[e("label",{children:"Color Space"}),a("select",{defaultValue:"lab",children:[e("option",{value:"rgb",children:"RGB"}),e("option",{value:"lab",children:"LAB"}),e("option",{value:"hsv",children:"HSV"})]})]}),a("div",{className:"setting-item",children:[e("label",{children:"Smoothing"}),e("input",{type:"range",min:"0",max:"10",defaultValue:"3"})]}),a("div",{className:"setting-item",children:[e("label",{children:"Threshold"}),e("input",{type:"range",min:"0",max:"255",defaultValue:"128"})]})]})]}),a("div",{className:"color-preview",children:[a("div",{className:"preview-header",children:[e("span",{children:"Current Color"}),e("button",{className:`preview-toggle ${h?"active":""}`,onClick:()=>L(!h),children:"Preview Mode"})]}),e("div",{className:"color-display",style:{backgroundColor:w},children:e("span",{className:"color-value",children:w})})]}),a("div",{className:"action-buttons",children:[a("button",{className:"action-btn primary",onClick:()=>z({mode:i.mode,color:w}),children:[e(Ie,{}),"Apply Smart Fill"]}),a("button",{className:"action-btn secondary",children:[e(na,{}),"Analyze Region"]})]}),a("div",{className:"tips-section",children:[e("h5",{children:"💡 Tips"}),a("ul",{children:[a("li",{children:["Use ",e("strong",{children:"Auto Fill"})," for large, uniform areas"]}),a("li",{children:["Try ",e("strong",{children:"Pattern Recognition"})," for textured surfaces"]}),a("li",{children:["Enable ",e("strong",{children:"Preview Mode"})," to see changes before applying"]}),e("li",{children:"Lower sensitivity for more precise edge detection"})]})]})]})]})},Pt=({history:i,onRevert:f,onSaveVersion:w,onDeleteVersion:z,onCompareVersions:v,currentCanvasData:b})=>{const[p,m]=n.useState(!1),[h,L]=n.useState(""),[I,T]=n.useState(""),[g,R]=n.useState([]),[k,P]=n.useState("timeline"),c=i.versions[i.currentIndex],D=i.currentIndex>0,u=i.currentIndex<i.versions.length-1,C=()=>{h.trim()&&(w(h.trim(),I.trim()),L(""),T(""),m(!1))},E=t=>{g.includes(t)?R(d=>d.filter(M=>M!==t)):g.length<2?R(d=>[...d,t]):R([t])},o=()=>{g.length===2&&v(g[0],g[1])},r=t=>{const M=Date.now()-t,F=Math.floor(M/6e4),G=Math.floor(M/36e5),O=Math.floor(M/864e5);return O>0?`${O} day${O>1?"s":""} ago`:G>0?`${G} hour${G>1?"s":""} ago`:F>0?`${F} minute${F>1?"s":""} ago`:"Just now"},N=()=>{const t=i.versions.length+1,M=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return`Version ${t} - ${M}`};return a("div",{className:"version-history",children:[a("div",{className:"history-header",children:[e("h3",{children:"📚 Version History"}),a("div",{className:"header-actions",children:[e("button",{onClick:()=>P(k==="timeline"?"grid":"timeline"),className:"view-toggle",title:`Switch to ${k==="timeline"?"grid":"timeline"} view`,children:k==="timeline"?"📋":"📅"}),a("button",{onClick:()=>m(!0),className:"save-btn",title:"Save Current Version",children:[e(va,{})," Save"]})]})]}),a("div",{className:"navigation-controls",children:[e("button",{onClick:()=>{var t;return f((t=i.versions[i.currentIndex-1])==null?void 0:t.id)},disabled:!D,className:"nav-btn",title:"Go to previous version",children:e(ga,{})}),a("div",{className:"current-version-info",children:[a("span",{className:"version-indicator",children:[i.currentIndex+1," of ",i.versions.length]}),c&&e("span",{className:"version-name",children:c.name})]}),e("button",{onClick:()=>{var t;return f((t=i.versions[i.currentIndex+1])==null?void 0:t.id)},disabled:!u,className:"nav-btn",title:"Go to next version",children:e(pa,{})})]}),g.length>0&&e("div",{className:"compare-section",children:a("div",{className:"compare-header",children:[a("span",{children:[g.length,"/2 selected for comparison"]}),g.length===2&&e("button",{onClick:o,className:"compare-btn",children:"Compare Versions"}),e("button",{onClick:()=>R([]),className:"clear-selection",children:"Clear"})]})}),e("div",{className:`versions-container ${k}`,children:k==="timeline"?e("div",{className:"timeline",children:i.versions.map((t,d)=>a("div",{className:`timeline-item ${d===i.currentIndex?"current":""} ${g.includes(t.id)?"selected":""}`,onClick:()=>E(t.id),children:[e("div",{className:"timeline-marker",children:d===i.currentIndex&&e("div",{className:"current-indicator"})}),a("div",{className:"timeline-content",children:[e("div",{className:"version-thumbnail",children:e("img",{src:t.thumbnail,alt:t.name})}),a("div",{className:"version-details",children:[e("h4",{children:t.name}),t.description&&e("p",{className:"version-description",children:t.description}),a("div",{className:"version-metadata",children:[a("span",{className:"timestamp",children:[e(je,{}),r(t.timestamp)]}),t.metadata&&a("div",{className:"metadata-tags",children:[t.metadata.pose&&a("span",{className:"tag",children:["Pose: ",t.metadata.pose]}),t.metadata.expression&&a("span",{className:"tag",children:["Expression: ",t.metadata.expression]})]})]}),a("div",{className:"version-actions",children:[e("button",{onClick:M=>{M.stopPropagation(),f(t.id)},className:"action-btn revert",title:"Revert to this version",children:"Revert"}),e("button",{onClick:M=>{var F;M.stopPropagation(),(F=navigator.clipboard)==null||F.writeText(t.canvasData)},className:"action-btn copy",title:"Copy version data",children:e(Na,{})}),d!==i.currentIndex&&e("button",{onClick:M=>{M.stopPropagation(),z(t.id)},className:"action-btn delete",title:"Delete this version",children:e(Me,{})})]})]})]})]},t.id))}):e("div",{className:"grid-view",children:i.versions.map((t,d)=>a("div",{className:`grid-item ${d===i.currentIndex?"current":""} ${g.includes(t.id)?"selected":""}`,onClick:()=>E(t.id),children:[a("div",{className:"grid-thumbnail",children:[e("img",{src:t.thumbnail,alt:t.name}),d===i.currentIndex&&e("div",{className:"current-badge",children:"Current"})]}),a("div",{className:"grid-info",children:[e("h5",{children:t.name}),e("span",{className:"grid-timestamp",children:r(t.timestamp)})]}),a("div",{className:"grid-actions",children:[e("button",{onClick:M=>{M.stopPropagation(),f(t.id)},title:"Revert",children:"↶"}),d!==i.currentIndex&&e("button",{onClick:M=>{M.stopPropagation(),z(t.id)},className:"delete-grid",title:"Delete",children:"×"})]})]},t.id))})}),a("div",{className:"history-stats",children:[a("div",{className:"stat-item",children:[e("span",{className:"stat-value",children:i.versions.length}),e("span",{className:"stat-label",children:"Total Versions"})]}),a("div",{className:"stat-item",children:[a("span",{className:"stat-value",children:[Math.round(i.versions.length/i.maxVersions*100),"%"]}),e("span",{className:"stat-label",children:"Storage Used"})]})]}),p&&e("div",{className:"save-dialog-overlay",children:a("div",{className:"save-dialog",children:[e("h3",{children:"Save New Version"}),a("div",{className:"form-group",children:[e("label",{children:"Version Name"}),e("input",{type:"text",value:h,onChange:t=>L(t.target.value),placeholder:N(),autoFocus:!0})]}),a("div",{className:"form-group",children:[e("label",{children:"Description (Optional)"}),e("textarea",{value:I,onChange:t=>T(t.target.value),placeholder:"Describe what changed in this version...",rows:3})]}),a("div",{className:"dialog-actions",children:[e("button",{onClick:()=>m(!1),children:"Cancel"}),e("button",{onClick:C,className:"primary",children:"Save Version"})]})]})})]})},j=(i={})=>({size:5,opacity:100,hardness:80,tipShape:"round",pressureSensitivity:!1,spacing:25,scattering:0,rotation:0,flowRate:100,smoothing:0,tapering:{enabled:!1,startTaper:0,endTaper:0},...i}),za=[{id:"basic-brush",name:"Basic Brush",tool:"brush",category:"basic",description:"Standard brush for general drawing",icon:"🖌️",minSize:1,maxSize:100,supportsTexture:!0,supportsPressure:!0,defaultSettings:j({size:10,opacity:80,hardness:70,pressureSensitivity:!0})},{id:"pencil",name:"Pencil",tool:"pencil",category:"basic",description:"Traditional pencil for sketching",icon:"✏️",minSize:.5,maxSize:20,supportsTexture:!0,supportsPressure:!0,defaultSettings:j({size:2,opacity:60,hardness:90,pressureSensitivity:!0,spacing:15,texturePath:"/textures/pencil-grain.png"})},{id:"marker",name:"Marker",tool:"marker",category:"basic",description:"Smooth marker for bold strokes",icon:"🖊️",minSize:3,maxSize:50,supportsTexture:!1,supportsPressure:!1,defaultSettings:j({size:15,opacity:70,hardness:30,tipShape:"diagonal",flowRate:80})},{id:"airbrush",name:"Airbrush",tool:"airbrush",category:"basic",description:"Soft airbrush for gradual shading",icon:"💨",minSize:5,maxSize:200,supportsTexture:!1,supportsPressure:!0,defaultSettings:j({size:30,opacity:30,hardness:0,pressureSensitivity:!0,flowRate:50,smoothing:80})},{id:"fine-liner",name:"Fine Liner",tool:"fine-liner",category:"detail",description:"Ultra-precise tool for eyelashes, hair strands, and fine details",icon:"🖋️",minSize:.1,maxSize:3,supportsTexture:!1,supportsPressure:!0,defaultSettings:j({size:.5,opacity:95,hardness:95,pressureSensitivity:!0,spacing:5,smoothing:20,tapering:{enabled:!0,startTaper:10,endTaper:30}})},{id:"detail-brush",name:"Detail Brush",tool:"detail-brush",category:"detail",description:"Small brush for tiny highlights and micro-details",icon:"✨",minSize:.2,maxSize:8,supportsTexture:!0,supportsPressure:!0,defaultSettings:j({size:1.5,opacity:85,hardness:80,pressureSensitivity:!0,spacing:20,smoothing:40})},{id:"calligraphy",name:"Calligraphy Pen",tool:"calligraphy",category:"detail",description:"Variable width pen that responds to stroke direction and pressure",icon:"🖋️",minSize:.5,maxSize:20,supportsTexture:!1,supportsPressure:!0,defaultSettings:j({size:8,opacity:90,hardness:85,tipShape:"diagonal",pressureSensitivity:!0,spacing:10,tapering:{enabled:!0,startTaper:20,endTaper:20}})},{id:"pixel-brush",name:"Pixel Brush",tool:"pixel-brush",category:"detail",description:"Perfect for pixel-art style details and crisp edges",icon:"⬛",minSize:1,maxSize:10,supportsTexture:!1,supportsPressure:!1,defaultSettings:j({size:1,opacity:100,hardness:100,tipShape:"square",spacing:100,smoothing:0})},{id:"texture-brush",name:"Texture Brush",tool:"texture-brush",category:"texture",description:"Specialized for hair texture, fabric patterns, and surface details",icon:"🌾",minSize:3,maxSize:50,supportsTexture:!0,supportsPressure:!0,defaultSettings:j({size:12,opacity:60,hardness:60,pressureSensitivity:!0,spacing:40,scattering:20,rotation:15,texturePath:"/textures/hair-texture.png"})},{id:"basic-eraser",name:"Basic Eraser",tool:"eraser",category:"basic",description:"Standard eraser for general corrections",icon:"🗑️",minSize:2,maxSize:100,supportsTexture:!1,supportsPressure:!0,defaultSettings:j({size:15,opacity:100,hardness:70,pressureSensitivity:!0})},{id:"precision-eraser",name:"Precision Eraser",tool:"precision-eraser",category:"detail",description:"Ultra-precise eraser for detailed corrections",icon:"🎯",minSize:.5,maxSize:10,supportsTexture:!1,supportsPressure:!0,defaultSettings:j({size:2,opacity:100,hardness:90,pressureSensitivity:!0,spacing:10})},{id:"soft-eraser",name:"Soft Eraser",tool:"soft-eraser",category:"effects",description:"Gradual eraser for smooth blending and soft corrections",icon:"☁️",minSize:5,maxSize:100,supportsTexture:!1,supportsPressure:!0,defaultSettings:j({size:25,opacity:50,hardness:20,pressureSensitivity:!0,flowRate:60,smoothing:60})},{id:"highlight-eraser",name:"Highlight Eraser",tool:"highlight-eraser",category:"effects",description:"Creates highlights and light effects by selective erasing",icon:"⭐",minSize:1,maxSize:30,supportsTexture:!0,supportsPressure:!0,defaultSettings:j({size:8,opacity:80,hardness:60,pressureSensitivity:!0,spacing:30,tapering:{enabled:!0,startTaper:0,endTaper:50}})}],$e=i=>za.find(f=>f.id===i),Ue={settings:j({size:.3,opacity:90,hardness:95,pressureSensitivity:!0,spacing:3,smoothing:15,tapering:{enabled:!0,startTaper:5,endTaper:40}})},Ve={settings:j({size:2,opacity:70,hardness:80,pressureSensitivity:!0,spacing:15,scattering:10,tapering:{enabled:!0,startTaper:0,endTaper:20}})};j({size:1,opacity:95,hardness:70,pressureSensitivity:!0,spacing:25,smoothing:30});const Lt=({onBack:i,uploadedFiles:f,onFileUpload:w,selectedReferenceUrl:z,backgroundSettings:v,showCustomization:b,onCustomizeToggle:p,showYumiReferences:m,setShowYumiReferences:h,onYumiReferenceSelect:L})=>{var Ke;const{user:I}=ma(),[T,g]=n.useState("layers"),[R,k]=n.useState("brush"),[P,c]=n.useState(((Ke=$e("basic-brush"))==null?void 0:Ke.defaultSettings)||{size:5,opacity:100,hardness:80,tipShape:"round",pressureSensitivity:!1,spacing:25,scattering:0,rotation:0,flowRate:100,smoothing:0,tapering:{enabled:!1,startTaper:0,endTaper:0}}),[D,u]=n.useState(null),[C,E]=n.useState(_e[0]),[o,r]=n.useState({characterLibrary:[],versionHistory:{versions:[],currentIndex:-1,maxVersions:20},showSmallWindow:!1,aiColorSuggestions:[],recommendedCombinations:[],smartBrushSettings:{mode:"auto_fill",sensitivity:75,blendStrength:85,preserveDetails:!0,detailLevel:"medium",edgeDetection:!0,colorBlending:"smooth"}}),[N,t]=n.useState(!1),[d,M]=n.useState(!1),[F,G]=n.useState(!1),[O,Q]=n.useState(!1),[y,_]=n.useState(!1),[H,$]=n.useState(Qa("image",{level:"balanced",yumiPersonality:"otaku",allowSuggestions:!0,memoryNudges:!0,iterativeMode:!0})),[me,Je]=n.useState(!1),[Ne,Ze]=n.useState([]),[Re]=n.useState(Ka()),[re,le]=n.useState({name:"",age:"",background:"",catchphrase:"",personalityTraits:[],visualMotifs:[],designElements:[]}),[Y,K]=n.useState({zoom:1,position:{x:0,y:0},tool:"brush",color:"#000000",size:5,opacity:100,blendMode:"normal",layers:[],activeLayerId:"base",hasDrawing:!1}),[X,pe]=n.useState([{id:"base",name:"Base Layer",canvas:document.createElement("canvas"),visible:!0,opacity:100,blendMode:"normal",locked:!1}]),[oe,ge]=n.useState("base");n.useEffect(()=>{I&&Be()},[I]);const se=s=>{const l=$e(s)||$e("basic-brush");l&&(k(s),c(l.defaultSettings),K(x=>({...x,tool:s,size:l.defaultSettings.size,opacity:l.defaultSettings.opacity})))},ne=()=>{k("fine-liner"),c(Ue.settings),K(s=>({...s,tool:"fine-liner",size:Ue.settings.size,opacity:Ue.settings.opacity}))},Se=()=>{k("texture-brush"),c(Ve.settings),K(s=>({...s,tool:"texture-brush",size:Ve.settings.size,opacity:Ve.settings.opacity}))},Ce=s=>{const l=H.controlSettings;$(x=>({...x,controlSettings:s})),s.yumiPersonality!==l.yumiPersonality&&$(x=>tt(x,{lastUsedPersonality:s.yumiPersonality}))},ve=s=>{const l=Ne.find(x=>x.id===s);if(l&&typeof l.content=="string"&&l.content.startsWith("data:image")){const x=new Image;x.onload=()=>{const U=X.find(W=>W.id===oe);if(U){const W=U.canvas.getContext("2d");W&&(W.clearRect(0,0,U.canvas.width,U.canvas.height),W.drawImage(x,0,0),Qe(oe,U.canvas))}},x.src=l.content}},De=s=>{if(H.controlSettings.level==="balanced"||H.controlSettings.allowSuggestions){const l=ee();it.generateBasePrompt(`Refine this image based on feedback: ${s.question}`,H.controlSettings),s.type==="style"||s.type==="mood"?M(!0):s.type==="detail"&&G(!0),$(x=>({...x,currentContext:{feedback:s,canvasData:l}}))}},Te=async()=>{if(H.controlSettings.iterativeMode){const s=ee(),l=[{id:`version_${Date.now()}_main`,type:"main",content:s,metadata:{aiConfidence:.8,refinementsSuggested:["Add more detail","Adjust colors","Refine pose"],personalityInfluence:[H.controlSettings.yumiPersonality]}}];H.controlSettings.allowSuggestions&&l.push({id:`version_${Date.now()}_alt`,type:"alternative",content:s,metadata:{aiConfidence:.7,refinementsSuggested:["Different style approach","Color variation"],personalityInfluence:[H.controlSettings.yumiPersonality]}}),Ze(l),Je(!0)}},Be=async()=>{try{const s=await ke.get("/api/anime-helper/characters");r(l=>({...l,characterLibrary:s.data}))}catch(s){console.error("Failed to load character library:",s)}},Ee=async(s,l)=>{try{const x=ee(),U={name:s,thumbnail:x,tags:ye(),createdAt:Date.now(),lastModified:Date.now(),versions:[{id:de(),name:"Initial Version",thumbnail:x,timestamp:Date.now(),description:l,canvasData:fe(),metadata:{pose:C.name,colors:[Y.color]}}],activeVersionId:""},W=await ke.post("/api/anime-helper/characters",U);r(ea=>({...ea,characterLibrary:[...ea.characterLibrary,W.data]}))}catch(x){console.error("Failed to save character:",x)}},S=s=>{const l=s.versions.find(x=>x.id===s.activeVersionId)||s.versions[0];l&&(ce(l.canvasData),r(x=>({...x,currentCharacter:s})))},A=(s,l)=>{const x=ee(),U={id:de(),name:s||`Version ${o.versionHistory.versions.length+1}`,thumbnail:x,timestamp:Date.now(),description:l,canvasData:fe(),metadata:{pose:C.name,colors:[Y.color]}};r(W=>({...W,versionHistory:{...W.versionHistory,versions:[...W.versionHistory.versions,U],currentIndex:W.versionHistory.versions.length}}))},B=s=>{const l=o.versionHistory.versions.find(x=>x.id===s);if(l){ce(l.canvasData);const x=o.versionHistory.versions.findIndex(U=>U.id===s);r(U=>({...U,versionHistory:{...U.versionHistory,currentIndex:x}}))}},q=async s=>{try{return(await ke.post("/api/anime-helper/analyze-colors",{imageData:s})).data}catch(l){return console.error("Failed to analyze colors:",l),{dominantColors:["#ff6b9d","#667eea","#4facfe"],colorHarmony:"complementary",suggestedPalettes:[],styleCategory:"anime",recommendations:{hairColor:["#8b4513","#ff69b4"],accentColors:["#ffd700","#32cd32"],backgroundSuggestions:["#e6f3ff","#fff0f5"]}}}},te=s=>{console.log("Smart brush auto-fill:",s)},V=s=>{if(t(!1),M(!1),G(!1),Q(!1),s==="character-library"){t(!0),g(null);return}else if(s==="ai-color-assistant"){M(!0),g(null);return}else if(s==="smart-brush"){G(!0),g(null);return}else if(s==="version-history"){Q(!0),g(null);return}g(s)},ee=()=>{const s=document.createElement("canvas");s.width=150,s.height=150;const l=s.getContext("2d");return l&&(l.fillStyle=Y.color,l.fillRect(0,0,s.width,s.height)),s.toDataURL()},fe=()=>JSON.stringify({canvasState:Y,layers:X.map(s=>({...s,canvas:s.canvas.toDataURL()})),characterData:re,selectedPose:C,currentBrushSettings:P}),ce=s=>{try{const l=JSON.parse(s);K(l.canvasState),le(l.characterData),E(l.selectedPose),l.currentBrushSettings&&c(l.currentBrushSettings)}catch(l){console.error("Failed to deserialize canvas state:",l)}},ye=()=>{const s=[];return re.personalityTraits.length>0&&s.push("personality"),C.name&&s.push("posed"),Y.hasDrawing&&s.push("custom"),s},de=()=>Math.random().toString(36).substr(2,9),Ia=()=>{const s={id:`layer-${X.length+1}`,name:`Layer ${X.length+1}`,canvas:document.createElement("canvas"),visible:!0,opacity:100,blendMode:"normal",locked:!1};pe(l=>[...l,s])},Xe=(s,l)=>{pe(x=>x.map(U=>U.id===s?{...U,...l}:U))},Pa=s=>{s===oe&&X.length>1&&ge(X[0].id),pe(l=>l.filter(x=>x.id!==s))},Qe=(s,l)=>{Xe(s,{canvas:l})},La=s=>{K(l=>({...l,...s}))},Ma=s=>{u(s.template),le(l=>({...l,designElements:[...l.designElements,`Template: ${s.template.name}`]}))},Aa=s=>{E(s),le(l=>({...l,designElements:[...l.designElements,`Pose: ${s.name}`]}))},Ra=()=>{switch(T){case"layers":return e(yt,{layers:X,activeLayerId:oe,onAddLayer:Ia,onUpdateLayer:Xe,onDeleteLayer:Pa,onSelectLayer:ge});case"palette":return e(bt,{color:Y.color,onColorChange:s=>K(l=>({...l,color:s}))});case"history":return e(Nt,{});case"export":return e(ka,{});case"search":return e(We,{onSelect:s=>{console.log("Reference image selected:",s)},onClose:()=>g(null)});case"templates":return e(St,{onComplete:Ma,designBrief:re});case"poses":return e(Ct,{selectedPose:C,onPoseSelect:Aa,onClose:()=>g(null)});default:return null}};return a("div",{className:"creation-mode",children:[e(Ca,{mode:"creative",context:T,setMode:()=>{},setContext:V,onBack:i,onToolChange:se,selectedTool:R,onCustomizeToggle:p,onFileUpload:w,onYumiRefsToggle:()=>h(!0),onCharacterLibraryToggle:()=>t(!N),onAIColorAssistantToggle:()=>M(!d),onSmartBrushToggle:()=>G(!F),onVersionHistoryToggle:()=>Q(!O)}),N&&e(xt,{library:o.characterLibrary,onSelect:S,onSave:Ee,onDelete:s=>{r(l=>({...l,characterLibrary:l.characterLibrary.filter(x=>x.id!==s)}))},onDuplicate:s=>{const l={...s,id:de(),name:`${s.name} Copy`};r(x=>({...x,characterLibrary:[...x.characterLibrary,l]}))},onVersionSelect:(s,l)=>{const x=o.characterLibrary.find(U=>U.id===s);if(x){const U=x.versions.find(W=>W.id===l);U&&ce(U.canvasData)}},onClose:()=>t(!1),currentCharacter:o.currentCharacter}),d&&e("div",{className:"ai-color-assistant-container",style:{position:"fixed",top:"60px",right:"20px",zIndex:1e3},children:e(zt,{onColorSelect:s=>K(l=>({...l,color:s})),onPaletteSelect:s=>{console.log("Palette selected:",s)},onAnalyze:q})}),F&&e("div",{className:"smart-brush-container",style:{position:"fixed",top:"60px",left:"20px",zIndex:1e3},children:e(It,{settings:o.smartBrushSettings,onSettingsChange:s=>r(l=>({...l,smartBrushSettings:s})),currentColor:Y.color,onAutoFill:te,isActive:y,onToggle:()=>_(!y)})}),O&&e("div",{className:"version-history-container",style:{position:"fixed",top:"60px",left:"380px",zIndex:1e3},children:e(Pt,{history:o.versionHistory,onRevert:B,onSaveVersion:A,onDeleteVersion:s=>{r(l=>({...l,versionHistory:{...l.versionHistory,versions:l.versionHistory.versions.filter(x=>x.id!==s)}}))},onCompareVersions:(s,l)=>{console.log("Compare versions:",s,l)},currentCanvasData:fe()})}),b&&a("div",{className:"customization-panel anime-customization",children:[e("h3",{children:"🎨 Creation Mode v1.2"}),a("div",{className:"customization-section",children:[e("h4",{children:"✨ Quick Brush Presets"}),a("div",{className:"quick-tools",children:[a("button",{onClick:ne,className:"preset-btn",children:[e(Sa,{})," Eyelashes"]}),a("button",{onClick:Se,className:"preset-btn",children:[e(be,{})," Hair Strands"]})]})]}),a("div",{className:"customization-section",children:[a("h4",{children:["🖌️ Current Brush: ",R]}),a("div",{className:"brush-settings",children:[a("div",{className:"setting-item",children:[a("label",{children:["Size: ",P.size]}),e("input",{type:"range",min:"0.1",max:"100",step:"0.1",value:P.size,onChange:s=>{const l=parseFloat(s.target.value);c(x=>({...x,size:l})),K(x=>({...x,size:l}))}})]}),a("div",{className:"setting-item",children:[a("label",{children:["Opacity: ",P.opacity,"%"]}),e("input",{type:"range",min:"1",max:"100",value:P.opacity,onChange:s=>{const l=parseInt(s.target.value);c(x=>({...x,opacity:l})),K(x=>({...x,opacity:l}))}})]}),a("div",{className:"setting-item",children:[a("label",{children:["Hardness: ",P.hardness,"%"]}),e("input",{type:"range",min:"0",max:"100",value:P.hardness,onChange:s=>{const l=parseInt(s.target.value);c(x=>({...x,hardness:l}))}})]})]})]}),a("div",{className:"customization-section",children:[e("h4",{children:"🛠️ Tool Categories"}),e("div",{className:"tool-categories",children:a("div",{className:"category",children:[e("h5",{children:"Detail Tools"}),e("div",{className:"tool-grid",children:za.filter(s=>s.category==="detail").map(s=>a("button",{onClick:()=>se(s.id),className:R===s.tool?"active":"",title:s.description,children:[s.icon," ",s.name]},s.id))})]})})]}),a("div",{className:"customization-section",children:[e("h4",{children:"v1.2 Creation Tools"}),a("div",{className:"quick-tools",children:[a("button",{onClick:()=>t(!N),className:N?"active":"",children:[e(Ge,{})," Library"]}),a("button",{onClick:()=>M(!d),className:d?"active":"",children:[e(Ye,{})," AI Colors"]}),a("button",{onClick:()=>G(!F),className:F?"active":"",children:[e(be,{})," Smart Brush"]}),a("button",{onClick:()=>Q(!O),className:O?"active":"",children:[e(je,{})," History"]}),e("button",{onClick:Te,className:"generate-versions-btn",children:"✨ Generate Versions"})]})]})]}),e(wa,{mode:"creative",tool:R,color:Y.color,size:Y.size,opacity:Y.opacity,blendMode:Y.blendMode,zoom:Y.zoom,position:Y.position,layers:X,activeLayerId:oe,onLayerChange:Qe,onStateChange:La,smartBrushActive:y,smartBrushSettings:o.smartBrushSettings,brushSettings:P}),T&&e("div",{className:"context-panel",children:Ra()}),m&&e(xa,{onClose:()=>h(!1),onSelect:L}),e(et,{currentSettings:H.controlSettings,onSettingsChange:Ce,userHistory:H.userHistory,availablePersonalities:Re,mode:"image"}),me&&Ne.length>0&&e(at,{versions:Ne,onVersionSelect:ve,onRequestRefinement:De,currentPersonality:H.controlSettings.yumiPersonality,refinementSuggestions:["Softer expressions","Brighter colors","Add more detail","Simplify composition","Change pose","Adjust lighting"]})]})},ra=[{id:"swimsuit-yumi",theme:"swimsuit",title:"🌊 Summer Beach Theme",prompt:"A stunning anime girl with long white hair and mesmerizing blue-purple eyes, standing on a sunny beach wearing a frilly white and blue bikini. She has a cheerful smile, gentle waves in the background, and holds a parasol. Her delicate hair flows with the sea breeze, and sunlight sparkles off the water.",negativePrompt:"nsfw, nude, revealing, inappropriate content, poor quality, low quality, bad anatomy, bad proportions, blurry, distorted",baseCharacter:{hairColor:"white",eyeColor:"blue-purple",name:"Yumi"}},{id:"maid-yumi",theme:"maid",title:"🧹 Elegant Maid Theme",prompt:"An elegant anime maid character with long white hair and blue-purple eyes, wearing a detailed black and white French maid outfit with lace and ribbons. She is slightly blushing, holding a silver tray with tea, standing in a classy Victorian-style café. Her hair is styled neatly with a cute headband, and soft lighting adds warmth to the scene.",negativePrompt:"nsfw, nude, revealing, inappropriate content, poor quality, low quality, bad anatomy, bad proportions, blurry, distorted",baseCharacter:{hairColor:"white",eyeColor:"blue-purple",name:"Yumi"}},{id:"seifuku-yumi",theme:"seifuku",title:"🎓 School Uniform Theme",prompt:"A cute anime schoolgirl with long white hair and blue-purple eyes, wearing a traditional Japanese sailor uniform (seifuku) with a blue skirt and ribbon. She's standing on a school rooftop with the wind gently blowing her hair, holding a bento box with a shy expression. Cherry blossoms are floating in the air.",negativePrompt:"nsfw, nude, revealing, inappropriate content, poor quality, low quality, bad anatomy, bad proportions, blurry, distorted",baseCharacter:{hairColor:"white",eyeColor:"blue-purple",name:"Yumi"}}];function Mt({onDone:i,hasImageGenAccess:f,freeTrialsUsed:w}){var N;const[z,v]=n.useState(!1),[b,p]=n.useState(""),[m,h]=n.useState([]),[L,I]=n.useState("swimsuit"),T=n.useRef(null),[g,R]=n.useState({visible:!1,message:"",type:"error"}),[k,P]=n.useState(0),c=3-w,D=!f&&c>0,[u,C]=n.useState({iterations:1,useCustomModel:!0,postProcessing:{upscale:!0,denoise:!0,lineArtCleanup:!0,colorCorrection:{contrast:1,saturation:1,bloom:.5}}}),E=async t=>{var F;const d=(F=t.target.files)==null?void 0:F[0];if(!d)return;const M=new FileReader;M.onloadend=()=>{C(G=>({...G,referenceImage:M.result}))},M.readAsDataURL(d)},o=t=>{p(t)},r=async()=>{var t;if(!b.trim()){R({visible:!0,message:"Please enter a description for your character.",type:"warning"});return}v(!0),R({visible:!1,message:"",type:"error"});try{const d=D&&!b.trim()?((t=ra.find(F=>F.theme===L))==null?void 0:t.prompt)||"":b,M=await Fa(d,u);h(M),M[0]&&i(M[0].url)}catch(d){if(console.error("Generation error:",d),d.type==="BILLING_ERROR")R({visible:!0,message:d.userMessage||"Insufficient credits. Please check your balance.",type:"error"});else if(d.type==="API_ERROR")if(k<2){P(M=>M+1),R({visible:!0,message:"Temporarily unable to generate image. Retrying...",type:"info"}),setTimeout(()=>r(),2e3);return}else R({visible:!0,message:d.userMessage||"Service is currently unavailable. Please try again later.",type:"error"});else R({visible:!0,message:d.userMessage||"An unexpected error occurred. Please try again.",type:"error"})}finally{v(!1)}};return a("div",{className:"ai-generate-panel",children:[!f&&c<=0?e(Oe,{severity:"info",sx:{mb:2},children:"You've used all your free trials. Please purchase access to continue using image generation."}):D?a(Oe,{severity:"info",sx:{mb:2},children:["Try our curated themes! ",c," free trial",c!==1?"s":""," remaining."]}):null,D&&a(la,{children:[e(ae,{variant:"h6",sx:{mb:2},children:"Choose a Theme (or write your own prompt below)"}),a(Da,{value:L,onChange:(t,d)=>I(d),sx:{mb:2},children:[e(Fe,{label:"🌊 Swimsuit",value:"swimsuit"}),e(Fe,{label:"🧹 Maid",value:"maid"}),e(Fe,{label:"🎓 Seifuku",value:"seifuku"})]}),e(oa,{sx:{mb:2},children:e(ca,{children:e(ae,{variant:"body1",children:(N=ra.find(t=>t.theme===L))==null?void 0:N.prompt})})})]}),a(he,{container:!0,spacing:2,children:[f&&e(he,{item:!0,xs:12,children:a(J,{className:"reference-upload",sx:{mb:2},children:[e("input",{type:"file",ref:T,accept:"image/*",onChange:E,style:{display:"none"}}),e(ie,{variant:"outlined",onClick:()=>{var t;return(t=T.current)==null?void 0:t.click()},fullWidth:!0,children:"Upload Reference Image (Optional)"}),u.referenceImage&&e(J,{sx:{mt:1},children:e("img",{src:u.referenceImage,alt:"Reference",style:{maxWidth:"100%",maxHeight:200}})})]})}),a(he,{item:!0,xs:12,children:[e(da,{fullWidth:!0,multiline:!0,rows:4,placeholder:D?"Describe your character (or leave blank to use the selected theme)":"Describe your character...",value:b,onChange:t=>o(t.target.value),disabled:z}),g.visible&&e("div",{className:`error-message ${g.type}`,children:g.message})]}),e(he,{item:!0,xs:12,children:e(ie,{variant:"contained",onClick:r,disabled:z||!f&&c<=0,fullWidth:!0,children:z?e(ha,{size:24}):"Generate Character"})})]}),m.length>0&&a(J,{sx:{mt:2},children:[e(ae,{variant:"h6",gutterBottom:!0,children:"Generated Images"}),e(he,{container:!0,spacing:2,children:m.map((t,d)=>e(he,{item:!0,xs:12,sm:6,children:e("img",{src:t.url,alt:`Generated ${d+1}`,style:{width:"100%",cursor:"pointer"},onClick:()=>i(t.url)})},d))})]}),z&&a("div",{className:"loading-overlay",children:[e("div",{className:"loading-spinner"}),e("p",{children:"Creating your character..."})]})]})}const At=({onOutlineGenerated:i,onClose:f})=>{const[w,z]=n.useState(!1),[v,b]=n.useState("image"),[p,m]=n.useState(""),[h,L]=n.useState(null),[I,T]=n.useState(.7),[g,R]=n.useState(.5),[k,P]=n.useState(null),c=n.useRef(null),D=C=>{var r;const E=(r=C.target.files)==null?void 0:r[0];if(!E)return;const o=new FileReader;o.onloadend=()=>{L(o.result),b("image")},o.readAsDataURL(E)},u=async()=>{if(!h&&!p.trim()){P("Please upload an image or enter a text description");return}z(!0),P(null);try{const C={type:v,...v==="image"?{image:h,strength:I,detailLevel:g}:{prompt:p,detailLevel:g}},E=await fetch("/api/anime-chara-helper/generate-outline",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)});if(!E.ok)throw new Error("Failed to generate outline");const o=await E.json();i(o.outlineUrl)}catch(C){P(C.message||"Failed to generate outline")}finally{z(!1)}};return e(oa,{className:"ai-outline-generator",children:a(ca,{children:[a(J,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e(ae,{variant:"h6",component:"h2",children:"AI Outline Generator"}),e(ie,{onClick:f,size:"small",children:"✕"})]}),k&&e(Oe,{severity:"error",sx:{mb:2},children:k}),a(J,{mb:3,children:[e(ae,{variant:"subtitle2",gutterBottom:!0,children:"Input Method"}),a(J,{display:"flex",gap:1,children:[e(ie,{variant:v==="image"?"contained":"outlined",startIcon:e(xe,{}),onClick:()=>b("image"),size:"small",children:"From Image"}),e(ie,{variant:v==="text"?"contained":"outlined",startIcon:e(ze,{}),onClick:()=>b("text"),size:"small",children:"From Description"})]})]}),v==="image"&&a(J,{mb:3,children:[e("input",{type:"file",ref:c,accept:"image/*",onChange:D,style:{display:"none"}}),e(ie,{variant:"outlined",startIcon:e(Pe,{}),onClick:()=>{var C;return(C=c.current)==null?void 0:C.click()},fullWidth:!0,sx:{mb:2},children:"Upload Reference Image"}),h&&e(J,{className:"image-preview",children:e("img",{src:h,alt:"Reference"})})]}),v==="text"&&e(J,{mb:3,children:e(da,{fullWidth:!0,multiline:!0,rows:4,label:"Describe what you want to outline",placeholder:"e.g., A cute anime girl with long hair wearing a school uniform...",value:p,onChange:C=>m(C.target.value)})}),a(J,{mb:3,children:[e(ae,{variant:"subtitle2",gutterBottom:!0,children:"Outline Settings"}),v==="image"&&a(J,{mb:2,children:[a(ae,{variant:"body2",gutterBottom:!0,children:["Outline Strength: ",Math.round(I*100),"%"]}),e(aa,{value:I,onChange:(C,E)=>T(E),min:.1,max:1,step:.1,marks:[{value:.3,label:"Soft"},{value:.7,label:"Medium"},{value:1,label:"Strong"}]})]}),a(J,{children:[a(ae,{variant:"body2",gutterBottom:!0,children:["Detail Level: ",Math.round(g*100),"%"]}),e(aa,{value:g,onChange:(C,E)=>R(E),min:.1,max:1,step:.1,marks:[{value:.2,label:"Simple"},{value:.5,label:"Medium"},{value:.8,label:"Detailed"}]})]})]}),e(ie,{variant:"contained",fullWidth:!0,onClick:u,disabled:w||!h&&!p.trim(),startIcon:w?e(ha,{size:20}):e(ze,{}),children:w?"Generating Outline...":"Generate Outline"}),e(J,{mt:2,children:e(ae,{variant:"caption",color:"textSecondary",children:"💡 Tips: Upload clear images for better outlines. Higher detail levels take longer to process."})})]})})},Rt=({onBack:i,onSwitchToCreation:f,uploadedFiles:w,onFileUpload:z,selectedReferenceUrl:v,showCustomization:b,onCustomizeToggle:p,showYumiReferences:m,setShowYumiReferences:h,onYumiReferenceSelect:L})=>{const I=ua(),{user:T}=ma(),[g,R]=n.useState(!1),[k,P]=n.useState(0),[c,D]=n.useState(null),[u,C]=n.useState(null),[E,o]=n.useState("brush"),[r,N]=n.useState(!1),[t,d]=n.useState(!1),[M,F]=n.useState({name:"",age:"",background:"",catchphrase:"",personalityTraits:[],visualMotifs:[],designElements:[]});n.useEffect(()=>{T&&ke.get("/api/billing/image-gen-status").then($=>{R($.data.hasAccess),P($.data.freeTrialsUsed||0)}).catch(console.error)},[T]);const G=$=>{if($==="ai-outline"){N(!0);return}o($)},O=$=>{C($)},Q=$=>{D($),console.log("Image generated:",$)},y=$=>{N(!1),console.log("Outline generated:",$)},_=()=>{!g&&k>=3&&d(!0)},H=()=>{switch(u){case"export":return e(ka,{});case"search":return e(We,{onSelect:$=>{console.log("Reference image selected:",$)},onClose:()=>C(null)});default:return null}};return a("div",{className:"image-generation-mode",children:[e(Ca,{mode:"ai-generate",context:u,setMode:()=>{},setContext:O,onBack:i,onToolChange:G,selectedTool:E,onCustomizeToggle:p,onFileUpload:z,onYumiRefsToggle:()=>h(!0),onCharacterLibraryToggle:()=>{},onAIColorAssistantToggle:()=>{},onSmartBrushToggle:()=>{},onVersionHistoryToggle:()=>{}}),b&&a("div",{className:"customization-panel anime-customization",children:[e("h3",{children:"🤖 AI Generation Mode"}),a("div",{className:"customization-section",children:[e("h4",{children:"Generation Status"}),a("div",{className:"status-info",children:[a("div",{className:"status-item",children:[e("span",{children:"Access Level: "}),e("span",{className:g?"status-premium":"status-free",children:g?"Premium":"Free Trial"})]}),!g&&a("div",{className:"status-item",children:[e("span",{children:"Free Trials Used: "}),a("span",{children:[k,"/3"]})]})]})]}),a("div",{className:"customization-section",children:[e("h4",{children:"Quick Actions"}),a("div",{className:"quick-tools",children:[e("button",{onClick:f,children:"🎨 Switch to Creation Mode"}),e("button",{onClick:()=>N(!0),children:"✏️ AI Outline Generator"})]})]}),a("div",{className:"customization-section",children:[e("h4",{children:"Uploaded References"}),w.length>0?e("div",{className:"uploaded-files",children:w.map(($,me)=>a("div",{className:"file-item",children:[e("span",{children:$.name}),a("small",{children:["(",($.size/1024).toFixed(1)," KB)"]})]},me))}):e("p",{children:"No files uploaded yet. Use the upload icon to add reference images."})]})]}),e("div",{className:"ai-generate-container",children:e(Mt,{onDone:Q,hasImageGenAccess:g,freeTrialsUsed:k,onPaymentRequired:_})}),c&&e("div",{className:"generated-image-overlay",children:a("div",{className:"generated-image-container",children:[e("img",{src:c,alt:"Generated character"}),a("div",{className:"image-actions",children:[e("button",{onClick:()=>C("export"),children:"📤 Export"}),e("button",{onClick:f,children:"🎨 Edit in Creation Mode"})]})]})}),u&&e("div",{className:"context-panel",children:H()}),e(ia,{open:r,onClose:()=>N(!1),maxWidth:"md",fullWidth:!0,children:e(ta,{children:e(At,{onOutlineGenerated:y,onClose:()=>N(!1)})})}),e(ia,{open:t,onClose:()=>d(!1),maxWidth:"sm",fullWidth:!0,children:e(ta,{children:a(J,{textAlign:"center",p:3,children:[e(ae,{variant:"h6",gutterBottom:!0,children:"🎨 Unlock Image Generation"}),e(ae,{variant:"body1",color:"textSecondary",mb:3,children:"You've used all your free trials. Purchase access to continue creating amazing anime characters!"}),e(ie,{variant:"contained",color:"primary",onClick:()=>I("/charge"),fullWidth:!0,sx:{mb:2},children:"💎 Get Premium Access"}),e(ie,{variant:"outlined",onClick:()=>d(!1),fullWidth:!0,children:"Maybe Later"})]})})}),m&&e(xa,{onClose:()=>h(!1),onSelect:L})]})},Ut=({onBack:i})=>{const{language:f}=Ba(),w=ua(),[z,v]=n.useState("creative"),[b,p]=n.useState(!1),[m,h]=n.useState(!1),[L,I]=n.useState([]),[T,g]=n.useState(null),[R,k]=n.useState(!1),[P,c]=n.useState({type:"solid",color:"#2a2a3e",gradient:"linear-gradient(135deg, #2a2a3e 0%, #1a1a2e 100%)",image:"",opacity:.95}),D=t=>{if(I(d=>[...d,...t]),t[0]&&P.type==="image"){const d=new FileReader;d.onloadend=()=>{c(M=>({...M,image:d.result}))},d.readAsDataURL(t[0])}console.log("Files uploaded:",t.map(d=>d.name))},u=t=>{g(t),console.log("Yumi reference selected:",t)},C=()=>{v("creative")},E=()=>{v("ai-generate")},o=()=>{switch(P.type){case"solid":return{backgroundColor:P.color};case"gradient":return{background:P.gradient};case"image":return{backgroundImage:P.image?`url(${P.image})`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"};default:return{}}},r=()=>{i?i():w(-1)},N=()=>z==="ai-generate"?e(Rt,{onBack:r,onSwitchToCreation:C,uploadedFiles:L,onFileUpload:D,selectedReferenceUrl:T,showCustomization:m,onCustomizeToggle:()=>h(!m),showYumiReferences:R,setShowYumiReferences:k,onYumiReferenceSelect:u}):e(Lt,{onBack:r,uploadedFiles:L,onFileUpload:D,selectedReferenceUrl:T,backgroundSettings:P,showCustomization:m,onCustomizeToggle:()=>h(!m),showYumiReferences:R,setShowYumiReferences:k,onYumiReferenceSelect:u});return a("div",{className:"anime-chara-helper-app",style:{...z==="creative"?{...o(),opacity:P.opacity}:{}},children:[i&&e(Ta,{className:"back-button",onClick:r,sx:{position:"absolute",top:16,left:16,zIndex:1e3},children:e(nt,{})}),a("div",{className:"mode-switcher",children:[e("button",{onClick:C,className:`mode-btn ${z==="creative"?"active":""}`,title:"Creation Mode v1.2",children:"🎨 Create"}),e("button",{onClick:E,className:`mode-btn ${z==="ai-generate"?"active":""}`,title:"AI Generation Mode",children:"🤖 AI Generate"})]}),N(),m&&z==="creative"&&a("div",{className:"shared-customization-panel",children:[e("h3",{children:"🌈 Background Settings"}),a("div",{className:"customization-section",children:[e("h4",{children:"Background Type"}),a("div",{className:"bg-type-selector",children:[e("button",{className:P.type==="solid"?"active":"",onClick:()=>c(t=>({...t,type:"solid"})),children:"🎨 Solid"}),e("button",{className:P.type==="gradient"?"active":"",onClick:()=>c(t=>({...t,type:"gradient"})),children:"🌈 Gradient"}),e("button",{className:P.type==="image"?"active":"",onClick:()=>c(t=>({...t,type:"image"})),children:"🖼️ Image"})]}),P.type==="solid"&&e("div",{className:"color-picker",children:e("input",{type:"color",value:P.color,onChange:t=>c(d=>({...d,color:t.target.value}))})}),P.type==="gradient"&&a("div",{className:"gradient-presets",children:[e("button",{onClick:()=>c(t=>({...t,gradient:"linear-gradient(135deg, #2a2a3e 0%, #1a1a2e 100%)"})),children:"Dark Purple"}),e("button",{onClick:()=>c(t=>({...t,gradient:"linear-gradient(135deg, #ff6b9d 0%, #c44569 100%)"})),children:"Pink"}),e("button",{onClick:()=>c(t=>({...t,gradient:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"})),children:"Blue"})]}),a("div",{className:"opacity-slider",children:[a("label",{children:["Opacity: ",Math.round(P.opacity*100),"%"]}),e("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:P.opacity,onChange:t=>c(d=>({...d,opacity:parseFloat(t.target.value)}))})]})]})]}),e(Ea,{isOpen:b,onClose:()=>p(!1),mode:"anime-chara-helper",floatingMode:!b})]})};export{Ut as default};
//# sourceMappingURL=AnimeCharaHelperApp-ziGT7p_V.js.map
